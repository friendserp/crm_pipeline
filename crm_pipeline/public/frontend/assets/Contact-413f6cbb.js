import{f as ce}from"./DeleteLinkedDocModal-c0fc932d.js";import{_ as de}from"./ErrorPage-acc9aefd.js";import{_ as me}from"./Resizer-7cf0645f.js";import{_ as ue}from"./Icon-3ac2626d.js";import{g as _e,S as pe}from"./view-fc9f34d6.js";import{L as fe}from"./LayoutHeader-82704819.js";import{P as ge}from"./PhoneIcon-2a8d1724.js";import{C as ye}from"./CameraIcon-facbf9ff.js";import{D as ve}from"./DealsIcon-dc1f8fc1.js";import{_ as be}from"./DealsListView-983a0dcf.js";import{u as he,d as j,f as we,t as Ce,b as O,D as ke,e as xe}from"./UserAvatar-7e2b021e.js";import{u as De,s as ze,a as Se,_ as Ie}from"./modals-49388916.js";import{c as U,g as Me}from"./settings-dc117b2e.js";import{g as Ve}from"./global-080870c0.js";import{o as $e}from"./organizations-f7602453.js";import{s as Pe}from"./statuses-969fdf55.js";import{aU as Te,r as z,c as y,a0 as Le,Y as H,aT as S,aV as C,a as v,O as o,G as m,H as _,e as d,L as u,F as Re,V as M,g as l,b as i,a9 as V,I as qe,t as b,aE as G,n as Y}from"./index-07f63b4e.js";import{_ as Be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-87902b99.js";import{F as Ee}from"./FileUploader-e9e701fb.js";import{u as Fe}from"./pageMeta-c6702566.js";import"./EditIcon-d1ec43fb.js";import"./Link-9533fd53.js";import"./FadedScrollableDiv-e9e34484.js";import"./ArrowUpRightIcon-ea6835ba.js";import"./ListBulkActions-84d4d198.js";import"./ListFooter-a4fa878a.js";import"./TabButtons-eec5fe46.js";import"./description-99653f97.js";const Ne={key:1,ref:"parentRef",class:"flex h-full"},Ae={class:"border-b"},je={class:"flex flex-col items-start justify-start gap-4 p-5"},Oe={class:"flex gap-4 items-center"},Ue={class:"group relative h-15.5 w-15.5"},He={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ge={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Ye={class:"truncate text-2xl font-medium"},Je={key:0},Ke={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},Qe={class:""},We={class:"flex gap-1.5"},Xe={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ze={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ea={class:"flex flex-col items-center justify-center space-y-3"},Ma={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(J){const{brand:K}=Me(),{makeCall:Q}=Ve(),{getUser:$}=he(),{getOrganization:P}=$e(),{getDealStatus:W}=Pe(),{doctypeMeta:X}=j("Contact"),h=J,f=Te(),T=z(""),Z=z(""),{document:a}=De("Contact",h.contactId),ee=y(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(f.query.view||f.query.viewType){let n=_e(f.query.view,f.query.viewType,"Contact");n&&e.push({label:__(n.label),icon:n.icon,route:{name:"Contacts",params:{viewType:f.query.viewType},query:{view:f.query.view}}})}return e.push({label:L.value,route:{name:"Contact",params:{contactId:h.contactId}}}),e}),L=y(()=>{var n,s;let e=((n=X.Contact)==null?void 0:n.title_field)||"name";return((s=a.doc)==null?void 0:s[e])||h.contactId});Fe(()=>({title:L.value,icon:K.favicon}));const k=z(!1);async function ae(){k.value=!0}function R(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{C.success(__("Contact image updated"))}})}const q=z(0),te=[{label:"Deals",icon:Le(ve,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=x.data)==null?void 0:e.length})}],x=H({url:"crm.api.contact.get_linked_deals",cache:["deals",h.contactId],params:{contact:h.contactId},auto:!0}),I=y(()=>!x.data||x.data==[]?[]:x.data.map(e=>le(e))),D=H({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),oe=y(()=>D.data?D.data.map(e=>({...e,columns:e.columns.map(n=>({...n,fields:n.fields.map(s=>{var p,w;return s.fieldname==="email_id"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(r=>({name:r.name,value:r.email_id,selected:r.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>B("email",r.email_id),onSave:(t,c)=>c?E("email",t.value):F("Contact Email",t.name,"email_id",t.value),onDelete:async(t,c)=>{a.doc.email_ids=a.doc.email_ids.filter(g=>g.name!==t.name),c||await N("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="mobile_no"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((w=a.doc)==null?void 0:w.phone_nos)||[]).map(r=>({name:r.name,value:r.phone,selected:r.phone===a.doc.mobile_no,onClick:()=>B("mobile_no",r.phone),onSave:(t,c)=>c?E("phone",t.value):F("Contact Phone",t.name,"phone",t.value),onDelete:async(t,c)=>{a.doc.phone_nos=a.doc.phone_nos.filter(g=>g.name!==t.name),c||await N("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="address"?{...s,create:(r,t)=>{A(),t&&t()},edit:r=>A(r)}:s})}))})):[]);async function B(e,n){await S("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function E(e,n){if(!n)return;await S("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function F(e,n,s,p){await S("frappe.client.set_value",{doctype:e,name:n,fieldname:s,value:p})&&(a.reload(),C.success(__("Contact updated")))}async function N(e,n){await S("frappe.client.delete",{doctype:e,name:n}),await a.reload(),C.success(__("Contact updated"))}const{getFormattedCurrency:ne}=j("CRM Deal"),se=y(()=>re);function le(e){var n,s;return{name:e.name,organization:{label:e.organization,logo:(n=P(e.organization))==null?void 0:n.organization_logo},annual_revenue:ne("annual_revenue",e),status:{label:e.status,color:(s=W(e.status))==null?void 0:s.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&$(e.deal_owner).full_name,...e.deal_owner&&$(e.deal_owner)},modified:{label:we(e.modified),timeAgo:__(Ce(e.modified))}}}const re=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function A(e){ze.value=!0,Se.value={doctype:"Address",address:e}}return(e,n)=>{const s=M("ErrorMessage"),p=M("Button"),w=M("Badge"),r=ce;return l(),v(Re,null,[o(a).doc?(l(),m(fe,{key:0},{"left-header":_(()=>[u(o(Be),{items:ee.value},{prefix:_(({item:t})=>[t.icon?(l(),m(ue,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):d("",!0)]),_:1},8,["items"])]),_:1})):d("",!0),o(a).doc?(l(),v("div",Ne,[o(a).doc?(l(),m(me,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:_(()=>[i("div",Ae,[u(o(Ee),{onSuccess:R,validateFile:o(xe)},{default:_(({openFileSelector:t,error:c})=>{var g;return[i("div",je,[i("div",Oe,[i("div",Ue,[u(o(O),{size:"3xl",class:"h-15.5 w-15.5",label:o(a).doc.full_name,image:o(a).doc.image},null,8,["label","image"]),(l(),m(V(o(a).doc.image?o(ke):"div"),qe(o(a).doc.image?{options:[{icon:"upload",label:o(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>R("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:_(()=>[i("div",He,[u(ye,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),i("div",Ge,[i("div",Ye,[o(a).doc.salutation?(l(),v("span",Je,b(o(a).doc.salutation+". "),1)):d("",!0),i("span",null,b(o(a).doc.full_name),1)]),o(a).doc.company_name?(l(),v("div",Ke,[u(o(O),{size:"xs",label:o(a).doc.company_name,image:(g=o(P)(o(a).doc.company_name))==null?void 0:g.organization_logo},null,8,["label","image"]),i("span",Qe,b(o(a).doc.company_name),1)])):d("",!0),u(s,{message:e.__(c)},null,8,["message"])])]),i("div",We,[o(U)&&o(a).doc.mobile_no?(l(),m(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ge,onClick:n[0]||(n[0]=ie=>o(U)&&o(Q)(o(a).doc.mobile_no))},null,8,["label"])):d("",!0),u(p,{label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:n[1]||(n[1]=ie=>ae())},null,8,["label"])])])]}),_:1},8,["validateFile"])]),o(D).data?(l(),v("div",Xe,[u(pe,{sections:oe.value,doctype:"Contact",docname:o(a).doc.name,onReload:o(D).reload},null,8,["sections","docname","onReload"])])):d("",!0)]),_:1},8,["parent"])):d("",!0),u(o(Ie),{as:"div",modelValue:q.value,"onUpdate:modelValue":n[2]||(n[2]=t=>q.value=t),tabs:te},{"tab-item":_(({tab:t,selected:c})=>[i("button",{class:Y(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":c}])},[t.icon?(l(),m(V(t.icon),{key:0,class:"h-5"})):d("",!0),G(" "+b(e.__(t.label))+" ",1),u(w,{class:Y(["group-hover:bg-surface-gray-7",[c?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:_(()=>[G(b(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":_(({tab:t})=>[t.label==="Deals"&&I.value.length?(l(),m(be,{key:0,class:"mt-4",rows:I.value,columns:se.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):d("",!0),I.value.length?d("",!0):(l(),v("div",Ze,[i("div",ea,[(l(),m(V(t.icon),{class:"!h-10 !w-10"})),i("div",null,b(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):T.value?(l(),m(de,{key:2,errorTitle:T.value,errorMessage:Z.value},null,8,["errorTitle","errorMessage"])):d("",!0),k.value?(l(),m(r,{key:3,modelValue:k.value,"onUpdate:modelValue":n[3]||(n[3]=t=>k.value=t),doctype:"Contact",docname:o(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):d("",!0)],64)}}};export{Ma as default};
//# sourceMappingURL=Contact-413f6cbb.js.map
