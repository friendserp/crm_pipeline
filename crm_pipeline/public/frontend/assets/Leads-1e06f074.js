import{J as ie,aU as ce,K as ue,j as ee,aR as Ce,k as we,r as w,U as j,l as a,m as i,I as u,D as v,L as _,F as te,B as xe,C as k,p as P,q as p,Y as se,M as V,N as h,a4 as pe,a as he,$ as G}from"./index-d54876c1.js";import{_ as Le}from"./ViewBreadcrumbs-86c09451.js";import{_ as fe}from"./MultipleAvatar-d00be64e.js";import{_ as Ve}from"./CustomActions-ab0be1d1.js";import{_ as $e,E as Me}from"./KanbanView-5346ea0c.js";import{P as le}from"./PhoneIcon-1fb4da28.js";import{_ as ze,N as re}from"./NoteModal-828cb13b.js";import{T as de}from"./TaskIcon-3b3b24ca.js";import{C as Ue}from"./CommentIcon-58bbf95d.js";import{I as Q}from"./modals-2ff32448.js";import{L as Ae}from"./LeadsIcon-c713c766.js";import{L as Te}from"./LayoutHeader-e14a2860.js";import{H as _e,_ as Re}from"./ListBulkActions-c260ba88.js";import{_ as De,a as Be,b as Ie,c as Pe,d as Se,e as Ee}from"./DeleteLinkedDocModal-5c61d607.js";import{b as U,D as me,d as qe,u as We,f as Y,w as je,t as N,i as Ke}from"./UserAvatar-34c53d4c.js";import{_ as He}from"./ListFooter-a1579762.js";import{_ as Je}from"./LeadModal-763454e5.js";import{T as Oe}from"./TaskModal-e6d4e307.js";import{_ as Ge}from"./ViewControls-4b40bc5b.js";import{g as Ye}from"./global-6174b3e1.js";import{s as Qe}from"./statuses-e1940a1a.js";import{c as Xe}from"./DragVerticalIcon-bf707ece.js";import"./Icon-8af02f75.js";import"./Link-ea1b258c.js";import"./ArrowUpRightIcon-1e1a48e6.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-d79548f0.js";import"./helpCenter-55cd6303.js";import"./EditIcon-70eae3cf.js";import"./TabButtons-8028c70a.js";import"./description-981c0dd5.js";import"./FieldLayout-9efad236.js";import"./FadedScrollableDiv-0d28074d.js";import"./IconPicker-b6264045.js";import"./PinIcon-de79c7c4.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-44f0eff0.js";import"./DetailsIcon-783ac0ef.js";import"./settings-d4673873.js";import"./pageMeta-1e607448.js";const Ze={key:0,class:"flex items-center"},Fe={key:0},Ne={key:1},et={key:2},tt={key:3},st=["onClick"],lt={key:1},at={key:2,class:"truncate text-base"},ot={key:3},nt=["onClick"],it={__name:"LeadsListView",props:ie({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:ie(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(g,{expose:X,emit:Z}){const C=Z,K=ce(),$=ue(g,"modelValue"),D=ue(g,"list"),S=ee(()=>{var n,f;return!!((f=(n=D.value.params)==null?void 0:n.filters)!=null&&f._liked_by)}),{user:E}=Ce();function M(n){if(n)return JSON.parse(n).includes(E)}we($,(n,f)=>{n!==f&&C("updatePageCount",n)});const B=w(null);return X({customListActions:ee(()=>{var n;return(n=B.value)==null?void 0:n.customListActions})}),(n,f)=>{const A=j("Button"),q=j("Badge"),L=j("FormControl");return a(),i(te,null,[u(_(Ee),{class:P(n.$attrs.class),columns:g.columns,rows:g.rows,options:{getRowRoute:l=>({name:"Lead",params:{leadId:l.name},query:{view:_(K).query.view,viewType:_(K).params.viewType}}),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name","onUpdate:selections":f[2]||(f[2]=l=>C("selectionsChanged",l))},{default:v(()=>[u(_(De),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:f[1]||(f[1]=l=>C("columnWidthUpdated"))},{default:v(()=>[(a(!0),i(te,null,xe(g.columns,l=>(a(),k(_(Be),{key:l.key,item:l,onColumnWidthUpdated:m=>C("columnWidthUpdated",l)},{default:v(()=>[l.key=="_liked_by"?(a(),k(A,{key:0,variant:"ghosted",class:P(["!h-4",S.value?"fill-red-500":"fill-white"]),onClick:f[0]||(f[0]=()=>C("applyLikeFilter"))},{default:v(()=>[u(_e,{class:"h-4 w-4"})]),_:1},8,["class"])):p("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),u(Ie,{rows:g.rows,doctype:"CRM Lead"},{default:v(({idx:l,column:m,item:c,row:F})=>[m.key==="_assign"?(a(),i("div",Ze,[u(fe,{avatars:c,size:"sm",onClick:T=>C("applyFilter",{event:T,idx:l,column:m,item:c,firstColumn:g.columns[0]})},null,8,["avatars","onClick"])])):(a(),k(_(Pe),{key:1,item:c,align:m.align},{prefix:v(()=>[m.key==="status"?(a(),i("div",Fe,[u(Q,{class:P(c.color)},null,8,["class"])])):m.key==="lead_name"?(a(),i("div",Ne,[c.label?(a(),k(_(U),{key:0,class:"flex items-center",image:c.image,label:c.image_label,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="lead_owner"?(a(),i("div",et,[c.full_name?(a(),k(_(U),{key:0,class:"flex items-center",image:c.user_image,label:c.full_name,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="mobile_no"?(a(),i("div",tt,[u(le,{class:"h-4 w-4"})])):p("",!0)]),default:v(({label:T})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(m.key)?(a(),i("div",{key:0,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:c,firstColumn:g.columns[0]})},[u(_(se),{text:c.label},{default:v(()=>[V("div",null,h(c.timeAgo),1)]),_:2},1032,["text"])],8,st)):m.key==="_liked_by"?(a(),i("div",lt,[m.key=="_liked_by"?(a(),k(A,{key:0,variant:"ghosted",class:P(M(c)?"fill-red-500":"fill-white"),onClick:pe(()=>C("likeDoc",{name:F.name,liked:M(c)}),["stop","prevent"])},{default:v(()=>[u(_e,{class:"h-4 w-4"})]),_:1},8,["class","onClick"])):p("",!0)])):m.key==="sla_status"?(a(),i("div",at,[c.value?(a(),k(q,{key:0,variant:"subtle",theme:c.color,size:"md",label:c.value,onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:c,firstColumn:g.columns[0]})},null,8,["theme","label","onClick"])):p("",!0)])):m.type==="Check"?(a(),i("div",ot,[u(L,{type:"checkbox",modelValue:c,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):(a(),i("div",{key:4,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:c,firstColumn:g.columns[0]})},h(T),9,nt))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),u(_(Se),null,{actions:v(({selections:l,unselectAll:m})=>[u(_(me),{options:B.value.bulkActions(l,m)},{default:v(()=>[u(A,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),$.value?(a(),k(_(He),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:$.value,"onUpdate:modelValue":f[3]||(f[3]=l=>$.value=l),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:f[4]||(f[4]=l=>C("loadMore"))},null,8,["modelValue","options"])):p("",!0),u(Re,{ref_key:"listBulkActionsRef",ref:B,modelValue:D.value,"onUpdate:modelValue":f[5]||(f[5]=l=>D.value=l),doctype:"CRM Lead"},null,8,["modelValue"])],64)}}},ut={class:"flex items-center gap-2"},rt={key:0},dt={key:1},_t={key:2},ct={key:3},pt={key:4},ft={key:5,class:"truncate text-base"},mt={key:6,class:"truncate text-base"},vt={key:7,class:"truncate text-base"},yt={key:8,class:"text-ink-gray-4"},kt={key:0,class:"truncate flex items-center gap-2"},bt={key:0},gt={key:1},Ct={key:2},wt={key:3},xt={key:4,class:"truncate text-base"},ht={key:5,class:"truncate text-base"},Lt={key:6,class:"flex items-center"},Vt={key:7,class:"truncate text-base"},$t={class:"flex gap-2 items-center justify-between"},Mt={class:"text-ink-gray-5 flex items-center gap-1.5"},zt={key:0},Ut={key:1},At={key:2},Tt={key:3},Rt={key:2,class:"flex h-full items-center justify-center"},Dt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},bs={__name:"Leads",setup(g){const{getFormattedPercent:X,getFormattedFloat:Z,getFormattedCurrency:C}=qe("CRM Lead"),{makeCall:K}=Ye(),{getUser:$}=We(),{getLeadStatus:D}=Qe(),S=ce(),E=w(null),M=w(!1),B=he({}),n=w({}),f=w(1),A=w(1),q=w(20),L=w(null);function l(r,s){var y;function b(e){return e&&typeof e=="object"&&!Array.isArray(e)?e:{label:e}}return b((y=m.value)==null?void 0:y.find(e=>e.name==r)[s])}const m=ee(()=>{var r,s,b,y,e,t,d;return(s=(r=n.value)==null?void 0:r.data)!=null&&s.data?n.value.data.view_type==="group_by"?(y=(b=n.value)==null?void 0:b.data.group_by_field)!=null&&y.fieldname?c((e=n.value)==null?void 0:e.data.data,(t=n.value)==null?void 0:t.data.group_by_field,n.value.data.columns):[]:n.value.data.view_type==="kanban"?F(n.value.data.data,n.value.data.fields):T((d=n.value)==null?void 0:d.data.data,n.value.data.columns):[]});function c(r,s,b){var e;let y=[];return(e=s.options)==null||e.forEach(t=>{let d=[];t?d=r.filter(o=>o[s.fieldname]==t):d=r.filter(o=>!o[s.fieldname]);let W={label:s.label,group:t||__(" "),collapsed:!1,rows:T(d,b)};s.fieldname=="status"&&(W.icon=()=>{var o;return G(Q,{class:(o=D(t))==null?void 0:o.color})}),y.push(W)}),y||r}function F(r,s){let b=[];return r.forEach(y=>{var e;(e=y.data)==null||e.forEach(t=>{b.push(t)})}),T(b,s)}function T(r,s=[]){let b=n.value.data.view_type,y=b==="kanban"?"fieldname":"key",e=b==="kanban"?"fieldtype":"type";return r.map(t=>{var W;let d={};return(W=n.value)==null||W.data.rows.forEach(o=>{var ae,oe;d[o]=t[o];let z=(ae=s==null?void 0:s.find(x=>(x[y]||x.value)==o))==null?void 0:ae[e];if(z&&["Date","Datetime"].includes(z)&&!["modified","creation"].includes(o)&&(d[o]=Y(t[o],"",!0,z=="Datetime")),z&&z=="Currency"&&(d[o]=C(o,t)),z&&z=="Float"&&(d[o]=Z(o,t)),z&&z=="Percent"&&(d[o]=X(o,t)),o=="lead_name")d[o]={label:t.lead_name,image:t.image,image_label:t.first_name};else if(o=="organization")d[o]=t.organization;else if(o==="website")d[o]=je(t.website);else if(o=="status")d[o]={label:t.status,color:(oe=D(t.status))==null?void 0:oe.color};else if(o=="sla_status"){let x=t.sla_status,I=x,ne=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";x=="First Response Due"&&(x=__(N(t.response_by)),I=Y(t.response_by),new Date(t.response_by)<new Date&&(ne="red")),d[o]={label:I,value:x,color:ne}}else if(o=="lead_owner")d[o]={label:t.lead_owner&&$(t.lead_owner).full_name,...t.lead_owner&&$(t.lead_owner)};else if(o=="_assign"){let x=JSON.parse(t._assign||"[]");d[o]=x.map(I=>({name:I,image:$(I).user_image,label:$(I).full_name}))}else if(["modified","creation"].includes(o))d[o]={label:Y(t[o]),timeAgo:__(N(t[o]))};else if(["first_response_time","first_responded_on","response_by"].includes(o)){let x=o=="response_by"?"response_by":"first_responded_on";d[o]={label:t[x]?Y(t[x]):"",timeAgo:t[o]?o=="first_response_time"?Ke(t[o]):__(N(t[o])):""}}}),d._email_count=t._email_count,d._note_count=t._note_count,d._task_count=t._task_count,d._comment_count=t._comment_count,d})}function R(r){let s=n.value.params.column_field;s&&(B[s]=r.column.name),M.value=!0}function ve(r){var y;let s=((y=l(r,"mobile_no"))==null?void 0:y.label)||"";return[{icon:G(le,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>K(s),condition:()=>s&&Xe.value},{icon:G(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>ke(r)},{icon:G(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ge(r)}].filter(e=>e.condition?e.condition():!0)}const H=w(""),J=w(!1),ye=w({title:"",content:""});function ke(r){H.value=r,J.value=!0}const O=w(!1),be=w({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ge(r){H.value=r,O.value=!0}return(r,s)=>{const b=j("Button"),y=j("Badge");return a(),i(te,null,[u(Te,null,{"left-header":v(()=>[u(Le,{modelValue:L.value,"onUpdate:modelValue":s[0]||(s[0]=e=>L.value=e),routeName:"Leads"},null,8,["modelValue"])]),"right-header":v(()=>{var e;return[(e=E.value)!=null&&e.customListActions?(a(),k(Ve,{key:0,actions:E.value.customListActions},null,8,["actions"])):p("",!0),u(b,{variant:"solid",label:r.__("Create"),iconLeft:"plus",onClick:s[1]||(s[1]=t=>M.value=!0)},null,8,["label"])]}),_:1}),u(Ge,{ref_key:"viewControls",ref:L,modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value=e),loadMore:f.value,"onUpdate:loadMore":s[3]||(s[3]=e=>f.value=e),resizeColumn:A.value,"onUpdate:resizeColumn":s[4]||(s[4]=e=>A.value=e),updatedPageCount:q.value,"onUpdate:updatedPageCount":s[5]||(s[5]=e=>q.value=e),doctype:"CRM Lead",filters:{converted:0},options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),_(S).params.viewType=="kanban"?(a(),k($e,{key:0,modelValue:n.value,"onUpdate:modelValue":s[7]||(s[7]=e=>n.value=e),options:{getRoute:e=>({name:"Lead",params:{leadId:e.name},query:{view:_(S).query.view,viewType:_(S).params.viewType}}),onNewClick:e=>R(e)},onUpdate:s[8]||(s[8]=e=>L.value.updateKanbanSettings(e)),onLoadMore:s[9]||(s[9]=e=>L.value.loadMoreKanban(e))},{title:v(({titleField:e,itemName:t})=>[V("div",ut,[e==="status"?(a(),i("div",rt,[u(Q,{class:P(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(a(),i("div",dt,[u(_(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"sm"},null,8,["image","label"])])):e==="lead_name"&&l(t,e).label?(a(),i("div",_t,[u(_(U),{class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"sm"},null,8,["image","label"])])):e==="lead_owner"&&l(t,e).full_name?(a(),i("div",ct,[u(_(U),{class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"sm"},null,8,["image","label"])])):e==="mobile_no"?(a(),i("div",pt,[u(le,{class:"h-4 w-4"})])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),i("div",ft,[u(_(se),{text:l(t,e).label},{default:v(()=>[V("div",null,h(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),i("div",mt,[l(t,e).value?(a(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):l(t,e).label?(a(),i("div",vt,h(l(t,e).label),1)):(a(),i("div",yt,h(r.__("No Title")),1))])]),fields:v(({fieldName:e,itemName:t})=>[l(t,e).label?(a(),i("div",kt,[e==="status"?(a(),i("div",bt,[u(Q,{class:P(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(a(),i("div",gt,[u(_(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"xs"},null,8,["image","label"])])):e==="lead_name"?(a(),i("div",Ct,[l(t,e).label?(a(),k(_(U),{key:0,class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"xs"},null,8,["image","label"])):p("",!0)])):e==="lead_owner"?(a(),i("div",wt,[l(t,e).full_name?(a(),k(_(U),{key:0,class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"xs"},null,8,["image","label"])):p("",!0)])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),i("div",xt,[u(_(se),{text:l(t,e).label},{default:v(()=>[V("div",null,h(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),i("div",ht,[l(t,e).value?(a(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):e==="_assign"?(a(),i("div",Lt,[u(fe,{avatars:l(t,e).label,size:"xs"},null,8,["avatars"])])):(a(),i("div",Vt,h(l(t,e).label),1))])):p("",!0)]),actions:v(({itemName:e})=>[V("div",$t,[V("div",Mt,[u(Me,{class:"h-4 w-4"}),l(e,"_email_count").label?(a(),i("span",zt,h(l(e,"_email_count").label),1)):p("",!0),s[23]||(s[23]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(re,{class:"h-4 w-4"}),l(e,"_note_count").label?(a(),i("span",Ut,h(l(e,"_note_count").label),1)):p("",!0),s[24]||(s[24]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(de,{class:"h-4 w-4"}),l(e,"_task_count").label?(a(),i("span",At,h(l(e,"_task_count").label),1)):p("",!0),s[25]||(s[25]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(Ue,{class:"h-4 w-4"}),l(e,"_comment_count").label?(a(),i("span",Tt,h(l(e,"_comment_count").label),1)):p("",!0)]),u(_(me),{class:"flex items-center gap-2",options:ve(e),variant:"ghost",onClick:s[6]||(s[6]=pe(()=>{},["stop","prevent"]))},{default:v(()=>[u(b,{icon:"plus",variant:"ghost"})]),_:1},8,["options"])])]),_:1},8,["modelValue","options"])):n.value.data&&m.value.length?(a(),k(it,{key:1,ref_key:"leadsListView",ref:E,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":s[10]||(s[10]=e=>n.value.data.page_length_count=e),list:n.value,"onUpdate:list":s[11]||(s[11]=e=>n.value=e),rows:m.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:s[12]||(s[12]=()=>f.value++),onColumnWidthUpdated:s[13]||(s[13]=()=>A.value++),onUpdatePageCount:s[14]||(s[14]=e=>q.value=e),onApplyFilter:s[15]||(s[15]=e=>L.value.applyFilter(e)),onApplyLikeFilter:s[16]||(s[16]=e=>L.value.applyLikeFilter(e)),onLikeDoc:s[17]||(s[17]=e=>L.value.likeDoc(e)),onSelectionsChanged:s[18]||(s[18]=e=>L.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(a(),i("div",Rt,[V("div",Dt,[u(Ae,{class:"h-10 w-10"}),V("span",null,h(r.__("No {0} Found",[r.__("Leads")])),1),u(b,{label:r.__("Create"),iconLeft:"plus",onClick:s[19]||(s[19]=e=>M.value=!0)},null,8,["label"])])])):p("",!0),M.value?(a(),k(Je,{key:3,modelValue:M.value,"onUpdate:modelValue":s[20]||(s[20]=e=>M.value=e),defaults:B},null,8,["modelValue","defaults"])):p("",!0),J.value?(a(),k(ze,{key:4,modelValue:J.value,"onUpdate:modelValue":s[21]||(s[21]=e=>J.value=e),note:ye.value,doctype:"CRM Lead",doc:H.value},null,8,["modelValue","note","doc"])):p("",!0),O.value?(a(),k(Oe,{key:5,modelValue:O.value,"onUpdate:modelValue":s[22]||(s[22]=e=>O.value=e),task:be.value,doctype:"CRM Lead",doc:H.value},null,8,["modelValue","task","doc"])):p("",!0)],64)}}};export{bs as default};
//# sourceMappingURL=Leads-1e06f074.js.map
