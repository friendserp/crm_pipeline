import{u as z,n as A,q as P,D as C,_ as D,A as F,m as K,B as X}from"./UserAvatar-34c53d4c.js";import{A as Y}from"./ArrowUpRightIcon-1e1a48e6.js";import{L as G}from"./Link-ea1b258c.js";import{_ as H,J as V,K as U,a5 as Q,r as f,b as W,k as Z,U as _,l as h,C as b,D as r,M as n,N as v,q as R,I as l,L as i,Y as ee,aT as B,aX as ae,x as te}from"./index-d54876c1.js";import{_ as se}from"./DragVerticalIcon-bf707ece.js";import{_ as oe}from"./TextEditor.vue_vue_type_script_setup_true_lang-d79548f0.js";import{u as le}from"./helpCenter-55cd6303.js";const re={class:"flex items-center gap-3"},ne={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ie={class:"flex flex-col gap-4"},ue={class:"mb-1.5 text-xs text-ink-gray-5"},de={class:"mb-1.5 text-xs text-ink-gray-5"},ce={class:"flex flex-wrap items-center gap-2"},pe={class:"cursor-pointer text-ink-gray-9"},me={class:"w-36"},fe={class:"flex justify-end"},_e={__name:"TaskModal",props:V({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:V(["updateTask","after"],["update:modelValue","update:reloadTasks"]),setup(c,{emit:I}){const u=c,p=U(c,"modelValue"),x=U(c,"reloadTasks"),T=I,L=Q(),{users:O,getUser:g}=z(),{updateOnboardingStep:S}=le("frappecrm"),k=f(null),M=f(null),m=f(!1),a=f({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:u.doctype,reference_docname:null});function $(e){a.value.status=e}function E(e){a.value.priority=e}function J(){var o;if(!((o=u.task)!=null&&o.reference_docname))return;let e=u.task.reference_doctype=="CRM Deal"?"Deal":"Lead",t={leadId:u.task.reference_docname};e=="Deal"&&(t={dealId:u.task.reference_docname}),L.push({name:e,params:t})}async function N(){var e,t;if(a.value.assigned_to||(a.value.assigned_to=g().name),a.value.name){let o=await B("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value});o.name&&((e=x.value)==null||e.reload(),T("after",o))}else{let o=await B("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:u.doctype,reference_docname:u.doc||null,...a.value}},{onError:y=>{y.error.exc_type=="MandatoryError"&&(k.value="Title is mandatory")}});o.name&&(S("create_first_task"),ae("task_created"),(t=x.value)==null||t.reload(),T("after",o,!0))}p.value=!1}function w(){m.value=!1,setTimeout(()=>{var e,t,o;return(o=(t=(e=M.value)==null?void 0:e.el)==null?void 0:t.focus)==null?void 0:o.call(t)},100),te(()=>{a.value={...u.task},a.value.title&&(m.value=!0)})}return W(()=>p.value&&w()),Z(p,e=>{e&&w()}),(e,t)=>{const o=_("Button"),y=_("TextInput"),j=_("ErrorMessage"),q=_("Dialog");return h(),b(q,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=d=>p.value=d),options:{size:"xl"}},{"body-title":r(()=>{var d;return[n("div",re,[n("h3",ne,v(m.value?e.__("Edit Task"):e.__("Create Task")),1),(d=c.task)!=null&&d.reference_docname?(h(),b(o,{key:0,size:"sm",label:c.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),iconRight:Y,onClick:t[0]||(t[0]=s=>J())},null,8,["label"])):R("",!0)])]}),"body-content":r(()=>{var d;return[n("div",ie,[n("div",null,[n("div",ue,v(e.__("Title")),1),l(y,{ref_key:"title",ref:M,modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),placeholder:e.__("Call with John Doe"),required:""},null,8,["modelValue","placeholder"])]),n("div",null,[n("div",de,v(e.__("Description")),1),l(i(oe),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:t[2]||(t[2]=s=>a.value.description=s),placeholder:e.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),n("div",ce,[l(i(C),{options:i(P)($)},{default:r(()=>[l(o,{label:a.value.status},{prefix:r(()=>[l(A,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),l(G,{class:"form-control",value:i(g)(a.value.assigned_to).full_name,doctype:"User",onChange:t[3]||(t[3]=s=>a.value.assigned_to=s),placeholder:e.__("John Doe"),filters:{name:["in",(d=i(O).data.crmUsers)==null?void 0:d.map(s=>s.name)]},hideMe:!0},{prefix:r(()=>[l(D,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":r(({option:s})=>[l(D,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":r(({option:s})=>[l(i(ee),{text:s.value},{default:r(()=>[n("div",pe,v(i(g)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","placeholder","filters"]),n("div",me,[l(i(se),{class:"datepicker",modelValue:a.value.due_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.due_date=s),placeholder:e.__("01/04/2024 11:30 PM"),formatter:s=>i(F)(s,"",!0,!0),"input-class":"border-none"},null,8,["modelValue","placeholder","formatter"])]),l(i(C),{options:i(X)(E)},{default:r(()=>[l(o,{label:a.value.priority},{prefix:r(()=>[l(K,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])]),k.value?(h(),b(j,{key:0,class:"mt-4",message:e.__(k.value)},null,8,["message"])):R("",!0)])]}),actions:r(()=>[n("div",fe,[l(o,{label:m.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:N},null,8,["label"])])]),_:1},8,["modelValue"])}}},Te=H(_e,[["__scopeId","data-v-0a9f6907"]]);export{Te as T};
//# sourceMappingURL=TaskModal-e6d4e307.js.map
