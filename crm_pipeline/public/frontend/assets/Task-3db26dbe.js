import{_ as p,aU as f,a5 as _,m as r,M as t,N as a,p as u,q as c,s as y,F as g,B as x,l}from"./index-d54876c1.js";const k={name:"TaskDetail",setup(){const s=f(),e=_();return{route:s,router:e}},data(){return{task:null,timesheets:[],loading:!1,error:null}},computed:{taskId(){return console.log("Route params:",this.route.params),this.route.params.taskId},taskTimesheets(){return this.timesheets.filter(s=>s.time_logs&&s.time_logs.some(e=>e.task===this.taskId))},isLate(){var m;return!((m=this.task)!=null&&m.exp_end_date)||["Completed","Cancelled"].includes(this.task.status)?!1:new Date(this.task.exp_end_date)<new Date}},watch:{"$route.params.id":{handler(s,e){s!==e&&this.loadData()},immediate:!0}},async mounted(){console.log("Component mounted, taskId:",this.taskId),await this.loadData()},methods:{goBack(){this.router.back()},async loadData(){this.loading=!0,this.error=null;try{await Promise.all([this.loadTask(),this.loadTimesheets()])}catch(s){console.error("Error loading data:",s),this.error="Failed to load task data"}finally{this.loading=!1}},async loadTask(){try{if(console.log("Loading task with ID:",this.taskId),!this.taskId)throw new Error("No task ID provided in route");const s=await fetch("/api/method/frappe.client.get",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Task",name:this.taskId})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();e.message?this.task=e.message:await this.loadTaskAlternative()}catch(s){console.error("Error loading task with primary method:",s),await this.loadTaskAlternative()}},async loadTaskAlternative(){try{const s=await fetch(`/api/resource/Task/${encodeURIComponent(this.taskId)}`,{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();this.task=e.data}catch(s){throw console.error("Error loading task with alternative method:",s),new Error(`Task "${this.taskId}" not found`)}},async loadTimesheets(){try{console.log("ðŸ”„ Fetching all timesheets...");const s=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Timesheet",fields:["name","start_date","end_date","status","total_hours"],limit_page_length:100,order_by:"start_date desc"})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();console.log("âœ… Timesheets fetched:",e);const h=(await Promise.all(e.message.map(async o=>{console.log(`ðŸ” Fetching details for Timesheet: ${o.name}`);const i=await fetch("/api/method/frappe.client.get",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Timesheet",name:o.name})});if(!i.ok)return console.error(`âŒ Failed to fetch details for ${o.name}`),null;const n=await i.json();return console.log(`ðŸ“„ Timesheet ${o.name} details:`,n),n.message}))).filter(o=>o!==null);this.timesheets=h.filter(o=>{if(!o.time_logs||o.time_logs.length===0)return console.log(`âš ï¸ Timesheet ${o.name} has no time_logs`),!1;const i=o.time_logs.some(n=>n.task===this.taskId);return console.log(i?`âœ… Timesheet ${o.name} contains task ${this.taskId}`:`âŒ Timesheet ${o.name} does NOT contain task ${this.taskId}`),i}),console.log("ðŸŽ¯ Final filtered timesheets:",this.timesheets)}catch(s){console.error("ðŸ’¥ Error loading timesheets:",s),this.timesheets=[]}},getCSRFToken(){var e;const s=((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"";return console.log("CSRF Token:",s?"Found":"Not found"),s},getStatusClass(s){return{Open:"bg-blue-900 text-blue-200",Working:"bg-yellow-900 text-yellow-200",Completed:"bg-green-900 text-green-200",Cancelled:"bg-red-900 text-red-200",Overdue:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},getPriorityClass(s){return{Low:"bg-green-900 text-green-200",Medium:"bg-yellow-900 text-yellow-200",High:"bg-orange-900 text-orange-200",Urgent:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},getTimesheetStatusClass(s){return{Draft:"bg-gray-700 text-gray-300",Submitted:"bg-blue-900 text-blue-200",Cancelled:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},formatDate(s){if(!s)return"Not set";try{return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid date"}},formatDateTime(s){if(!s)return"Not set";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid date"}},formatCurrency(s){return`ETB ${parseFloat(s||0).toFixed(2)}`}}},b={class:"min-h-screen bg-[#233d48]"},v={key:0,class:"flex items-center justify-center min-h-screen"},w={key:1,class:"flex items-center justify-center min-h-screen"},T={class:"text-red-400 text-lg"},C={key:2},D={class:"bg-[#233d48] border-b border-[#2a4a58]"},S={class:"container mx-auto px-6 py-4"},j={class:"flex justify-between items-center"},F={class:"flex items-center space-x-4"},E={class:"text-2xl font-bold text-white"},I={class:"text-sm text-gray-300 mt-1"},N={class:"flex items-center gap-3"},R={key:0,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-900 text-red-200"},B={class:"container mx-auto px-6 py-6"},A={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},P={class:"lg:col-span-2 space-y-6"},L={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-6"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},H={class:"flex items-center gap-2"},M={class:"w-full bg-[#233d48] rounded-full h-2"},z={class:"text-sm text-gray-300 whitespace-nowrap"},U={class:"text-white"},X={class:"text-white"},J={class:"text-white"},q={class:"text-white"},V={class:"md:col-span-2"},G=["innerHTML"],W={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-6"},K={key:0,class:"text-center py-8 text-gray-400"},Q={key:1,class:"space-y-4"},Y={class:"flex justify-between items-start mb-3"},Z={class:"font-medium text-white"},$={class:"text-sm text-gray-300 mt-1"},tt={class:"flex items-center gap-2"},et={class:"text-right"},st={class:"font-semibold text-white"},ot={class:"border-t border-[#3a6374] pt-3"},at={class:"flex justify-between items-center"},it={class:"font-medium"},nt={key:0,class:"text-gray-400 mt-1"},rt={key:1,class:"text-gray-400 mt-1"},lt={class:"font-semibold text-white"},dt={class:"space-y-6"},ct={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-6"},mt={class:"space-y-3"},ut={class:"flex justify-between items-center"},ht={class:"font-semibold text-white"},gt={class:"flex justify-between items-center"},xt={class:"font-semibold text-white"},pt={class:"flex justify-between items-center"},ft={class:"font-semibold text-white"},_t={class:"flex justify-between items-center"},yt={class:"font-semibold text-white"},kt={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-6"},bt={class:"space-y-3 text-sm"},vt={class:"flex justify-between"},wt={class:"text-white"},Tt={class:"flex justify-between"},Ct={class:"text-white"},Dt={class:"flex justify-between"},St={class:"text-white"},jt={key:0,class:"flex justify-between"},Ft={class:"text-white"},Et={key:1,class:"flex justify-between"},It={class:"text-white"};function Nt(s,e,m,h,o,i){return l(),r("div",b,[o.loading?(l(),r("div",v,[...e[1]||(e[1]=[t("div",{class:"text-white text-lg"},"Loading task...",-1)])])):o.error?(l(),r("div",w,[t("div",T,a(o.error),1)])):o.task?(l(),r("div",C,[t("div",D,[t("div",S,[t("div",j,[t("div",F,[t("button",{onClick:e[0]||(e[0]=(...n)=>i.goBack&&i.goBack(...n)),class:"text-gray-300 hover:text-white"},[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("div",null,[t("h1",E,a(o.task.subject),1),t("div",I," #"+a(o.task.name)+" â€¢ "+a(o.task.type),1)])]),t("div",N,[t("span",{class:u(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium capitalize",i.getStatusClass(o.task.status)])},a(o.task.status),3),i.isLate?(l(),r("span",R," Late ")):c("",!0),e[3]||(e[3]=t("button",{class:"bg-[#2E86AB] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#257195] transition-colors"}," Edit Task ",-1))])])])]),t("div",B,[t("div",A,[t("div",P,[t("div",L,[e[11]||(e[11]=t("h2",{class:"text-lg font-semibold text-white mb-4"},"Task Details",-1)),t("div",O,[t("div",null,[e[4]||(e[4]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Priority",-1)),t("span",{class:u(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",i.getPriorityClass(o.task.priority)])},a(o.task.priority),3)]),t("div",null,[e[5]||(e[5]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Progress",-1)),t("div",H,[t("div",M,[t("div",{class:"bg-[#2E86AB] h-2 rounded-full",style:y({width:o.task.progress+"%"})},null,4)]),t("span",z,a(o.task.progress)+"%",1)])]),t("div",null,[e[6]||(e[6]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Expected Start",-1)),t("div",U,a(i.formatDate(o.task.exp_start_date)),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Expected End",-1)),t("div",X,a(i.formatDate(o.task.exp_end_date)),1)]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Actual Start",-1)),t("div",J,a(i.formatDate(o.task.act_start_date)||"Not started"),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Actual End",-1)),t("div",q,a(i.formatDate(o.task.act_end_date)||"Not completed"),1)]),t("div",V,[e[10]||(e[10]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Description",-1)),t("div",{class:"prose max-w-none text-gray-300",innerHTML:o.task.description||"No description provided"},null,8,G)])])]),t("div",W,[e[12]||(e[12]=t("div",{class:"flex justify-between items-center mb-6"},[t("h2",{class:"text-lg font-semibold text-white"},"Timesheets"),t("button",{class:"bg-[#2E86AB] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#257195] transition-colors"}," Add Timesheet ")],-1)),i.taskTimesheets.length===0?(l(),r("div",K," No timesheets recorded for this task ")):(l(),r("div",Q,[(l(!0),r(g,null,x(i.taskTimesheets,n=>(l(),r("div",{key:n.name,class:"bg-[#315566] border border-[#3a6374] rounded-lg p-4 hover:border-[#2E86AB] transition-colors"},[t("div",Y,[t("div",null,[t("div",Z,a(n.name),1),t("div",$,a(i.formatDate(n.start_date))+" - "+a(i.formatDate(n.end_date)),1)]),t("div",tt,[t("span",{class:u(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",i.getTimesheetStatusClass(n.status)])},a(n.status),3),t("div",et,[t("div",st,a(n.total_hours)+" hrs",1)])])]),t("div",ot,[(l(!0),r(g,null,x(n.time_logs,d=>(l(),r("div",{key:d.name,class:"text-sm text-gray-300 mb-2 last:mb-0"},[t("div",at,[t("div",null,[t("div",it,a(i.formatDateTime(d.from_time))+" - "+a(i.formatDateTime(d.to_time)),1),d.activity_type?(l(),r("div",nt," Activity: "+a(d.activity_type),1)):c("",!0),d.description?(l(),r("div",rt,a(d.description),1)):c("",!0)]),t("span",lt,a(d.hours)+" hrs",1)])]))),128))])]))),128))]))])]),t("div",dt,[t("div",ct,[e[17]||(e[17]=t("h3",{class:"font-semibold text-white mb-4"},"Financial Summary",-1)),t("div",mt,[t("div",ut,[e[13]||(e[13]=t("span",{class:"text-sm text-gray-300"},"Total Billing",-1)),t("span",ht,a(i.formatCurrency(o.task.total_billing_amount)),1)]),t("div",gt,[e[14]||(e[14]=t("span",{class:"text-sm text-gray-300"},"Total Costing",-1)),t("span",xt,a(i.formatCurrency(o.task.total_costing_amount)),1)]),t("div",pt,[e[15]||(e[15]=t("span",{class:"text-sm text-gray-300"},"Actual Time",-1)),t("span",ft,a(o.task.actual_time||0)+" hrs",1)]),t("div",_t,[e[16]||(e[16]=t("span",{class:"text-sm text-gray-300"},"Expected Time",-1)),t("span",yt,a(o.task.expected_time||0)+" hrs",1)])])]),t("div",kt,[e[23]||(e[23]=t("h3",{class:"font-semibold text-white mb-4"},"Task Information",-1)),t("div",bt,[t("div",vt,[e[18]||(e[18]=t("span",{class:"text-gray-300"},"Created",-1)),t("span",wt,a(i.formatDateTime(o.task.creation)),1)]),t("div",Tt,[e[19]||(e[19]=t("span",{class:"text-gray-300"},"Modified",-1)),t("span",Ct,a(i.formatDateTime(o.task.modified)),1)]),t("div",Dt,[e[20]||(e[20]=t("span",{class:"text-gray-300"},"Company",-1)),t("span",St,a(o.task.company),1)]),o.task.project?(l(),r("div",jt,[e[21]||(e[21]=t("span",{class:"text-gray-300"},"Project",-1)),t("span",Ft,a(o.task.project),1)])):c("",!0),o.task.depends_on_tasks?(l(),r("div",Et,[e[22]||(e[22]=t("span",{class:"text-gray-300"},"Dependencies",-1)),t("span",It,a(o.task.depends_on_tasks),1)])):c("",!0)])])])])])])):c("",!0)])}const Bt=p(k,[["render",Nt]]);export{Bt as default};
//# sourceMappingURL=Task-3db26dbe.js.map
