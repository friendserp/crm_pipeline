import{F as I}from"./FieldLayout-9efad236.js";import{E as D}from"./EditIcon-70eae3cf.js";import{u as N}from"./UserAvatar-34c53d4c.js";import{i as j}from"./DragVerticalIcon-bf707ece.js";import{u as B,s as Q,a as q,c as A,q as T}from"./modals-2ff32448.js";import{_ as U,J as F,a5 as L,K as O,r as P,X as R,b as S,x as b,U as v,l as m,C as p,D as X,M as n,N as z,L as d,q as C,I as h,aT as J,aX as K}from"./index-d54876c1.js";const $={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},G={class:"mb-5 flex items-center justify-between"},H={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},W={class:"flex items-center gap-1"},Y={class:"px-4 pb-7 pt-4 sm:px-6"},Z={class:"space-y-2"},ee={__name:"ContactModal",props:F({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const c=_,{isManager:g}=N(),x=L(),l=O(_,"modelValue"),k=P(!1),{document:e,triggerOnBeforeCreate:r}=B("Contact");async function M(){e.doc.email_id&&(e.doc.email_ids=[{email_id:e.doc.email_id,is_primary:1}],delete e.doc.email_id),e.doc.mobile_no&&(e.doc.phone_nos=[{phone:e.doc.mobile_no,is_primary_mobile_no:1}],delete e.doc.mobile_no),await(r==null?void 0:r());const t=await J("frappe.client.insert",{doc:{doctype:"Contact",...e.doc}});t.name&&(K("contact_created"),w(t))}function w(t){var o,s;(s=(o=c.contact)==null?void 0:o.reload)==null||s.call(o),t.name&&c.options.redirect&&x.push({name:"Contact",params:{contactId:t.name}}),l.value=!1,c.options.afterInsert&&c.options.afterInsert(t)}const f=R({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:t=>t.forEach(o=>{o.sections.forEach(s=>{s.columns.forEach(u=>{u.fields.forEach(a=>{a.fieldname=="email_id"||a.fieldname=="mobile_no"?a.read_only=!1:a.fieldname=="address"?(a.create=(i,V)=>{e.doc.address=i,y(),V()},a.edit=i=>y(i)):a.fieldtype==="Table"&&(e.doc[a.fieldname]=[])})})})})});S(()=>{e.doc={},Object.assign(e.doc,c.contact.data||c.contact)});function E(){A.value=!0,T.value={doctype:"Contact"},b(()=>l.value=!1)}function y(t){Q.value=!0,q.value={doctype:"Address",address:t},b(()=>l.value=!1)}return(t,o)=>{const s=v("Button"),u=v("Dialog");return m(),p(u,{modelValue:l.value,"onUpdate:modelValue":o[1]||(o[1]=a=>l.value=a),options:{size:"xl"}},{body:X(()=>{var a;return[n("div",$,[n("div",G,[n("div",null,[n("h3",H,z(t.__("New Contact")),1)]),n("div",W,[d(g)()&&!d(j)?(m(),p(s,{key:0,variant:"ghost",class:"w-7",tooltip:t.__("Edit fields layout"),icon:D,onClick:E},null,8,["tooltip"])):C("",!0),h(s,{variant:"ghost",class:"w-7",onClick:o[0]||(o[0]=i=>l.value=!1),icon:"x"})])]),(a=d(f).data)!=null&&a.length?(m(),p(I,{key:0,tabs:d(f).data,data:d(e).doc,doctype:"Contact"},null,8,["tabs","data"])):C("",!0)]),n("div",Y,[n("div",Z,[h(s,{class:"w-full",variant:"solid",label:t.__("Create"),loading:k.value,onClick:M},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},le=U(ee,[["__scopeId","data-v-179103b7"]]);export{le as C};
//# sourceMappingURL=ContactModal-64a59684.js.map
