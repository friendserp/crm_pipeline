import{_ as f,m as d,a2 as u,M as t,N as i,G as p,a1 as g,q as x,F as h,B as _,l as c,p as m}from"./index-d54876c1.js";const b={name:"Tasks",data(){return{tasks:[],timesheets:[],filters:{status:"all",priority:"all",type:"all"},overview:{ending_soon:0,late:0,requires_invoicing:0,action_required:0,unscheduled:0},loading:!1}},computed:{filteredTasks(){return this.tasks.filter(s=>!(this.filters.status!=="all"&&s.status!==this.filters.status||this.filters.priority!=="all"&&s.priority!==this.filters.priority||this.filters.type!=="all"&&s.type!==this.filters.type))},recentTimesheets(){const s=new Date;return s.setDate(s.getDate()-30),this.timesheets.filter(e=>{var a;return e.start_date?new Date(e.start_date)>=s&&((a=e.time_logs)==null?void 0:a.some(n=>n.task)):!1}).map(e=>{var n,l;const r=(l=(n=e.time_logs)==null?void 0:n.find(o=>o.task))==null?void 0:l.task,a=this.tasks.find(o=>o.name===r);return{...e,task_name:a?a.subject:"Unknown Task"}}).slice(0,5)}},async mounted(){await this.loadData()},watch:{filters:{handler(){this.calculateOverview()},deep:!0}},methods:{viewTask(s){this.$router.push(`/tasks/${s}`)},async loadData(){this.loading=!0;try{await Promise.all([this.loadTasks(),this.loadTimesheets()])}catch(s){console.error("Error loading data:",s)}finally{this.loading=!1}},async loadTasks(){try{const s=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Task",fields:["*"],limit_page_length:100,order_by:"modified desc"})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();this.tasks=e.message||[]}catch(s){console.error("Error loading tasks:",s)}},async loadTimesheets(){try{const s=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Timesheet",fields:["name","start_date","end_date","status","total_hours","time_logs"],limit_page_length:50,order_by:"start_date desc"})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();this.timesheets=e.message||[]}catch(s){console.error("Error loading timesheets:",s)}},getCSRFToken(){var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},calculateOverview(){const s=new Date,e=new Date(s);e.setDate(e.getDate()+30),this.overview={ending_soon:this.tasks.filter(r=>{if(!r.exp_end_date)return!1;const a=new Date(r.exp_end_date);return a<=e&&a>=s&&r.status!=="Completed"}).length,late:this.tasks.filter(r=>this.isLate(r)).length,requires_invoicing:this.tasks.filter(r=>r.total_billing_amount>0&&r.status==="Completed").length,action_required:this.tasks.filter(r=>["Open","Working"].includes(r.status)&&(r.progress===0||this.isLate(r))).length,unscheduled:this.tasks.filter(r=>!r.exp_start_date&&!r.exp_end_date).length}},isLate(s){return!s.exp_end_date||["Completed","Cancelled"].includes(s.status)?!1:new Date(s.exp_end_date)<new Date},getStatusClass(s){return{Open:"bg-blue-900 text-blue-200",Working:"bg-yellow-900 text-yellow-200",Completed:"bg-green-900 text-green-200",Cancelled:"bg-red-900 text-red-200",Overdue:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},getStatusColor(s){return{Open:"bg-blue-500",Working:"bg-yellow-500",Completed:"bg-green-500",Cancelled:"bg-red-500",Overdue:"bg-red-500"}[s]||"bg-gray-500"},getPriorityClass(s){return{Low:"bg-green-900 text-green-200",Medium:"bg-yellow-900 text-yellow-200",High:"bg-orange-900 text-orange-200",Urgent:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},formatDate(s){if(!s)return"No date";try{return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid date"}},formatCurrency(s){return`ETB ${parseFloat(s||0).toFixed(2)}`}}},y={class:"w-full bg-[#233d48]"},v={class:"container mx-auto px-6 py-6"},w={class:"mb-8"},T={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},k={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},C={class:"text-xl font-semibold text-white"},D={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},S={class:"text-xl font-semibold text-red-400"},E={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},A={class:"text-xl font-semibold text-white"},B={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},O={class:"text-xl font-semibold text-white"},j={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},F={class:"text-xl font-semibold text-white"},L={class:"bg-[#2a4a58] rounded-lg border border-[#315566]"},q={class:"p-6 border-b border-[#315566]"},N={class:"flex justify-between items-center"},P={class:"text-sm text-gray-300 mt-1"},R={class:"p-6 border-b border-[#315566] bg-[#315566]"},U={class:"flex flex-wrap gap-6"},M={class:"overflow-x-auto"},V={class:"w-full"},H={class:"divide-y divide-[#315566]"},W={key:0},z=["onClick"],I={class:"py-4 px-6"},J={class:"flex items-center space-x-3"},X={class:"font-medium text-white group-hover:text-[#2E86AB] transition-colors"},G={class:"text-sm text-gray-400 mt-1"},K={class:"text-sm text-gray-400 mt-1"},Q={key:0},Y={key:1},Z={key:2},$={class:"py-4 px-6"},tt={class:"py-4 px-6"},et={class:"text-sm text-white"},st={class:"text-sm text-gray-400"},ot={class:"py-4 px-6"},rt={class:"flex items-center gap-2"},it={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-900 text-red-200"},nt={class:"py-4 px-6"},lt={class:"font-medium text-white"};function at(s,e,r,a,n,l){return c(),d("div",y,[e[17]||(e[17]=u('<div class="bg-[#233d48] border-b border-[#2a4a58]"><div class="container mx-auto px-6 py-4"><div class="flex justify-between items-center"><h1 class="text-2xl font-bold text-white">Tasks</h1><button class="bg-[#2E86AB] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#257195] transition-colors"> Create Task </button></div></div></div>',1)),t("div",v,[t("div",w,[t("div",T,[t("div",k,[e[3]||(e[3]=t("div",{class:"text-sm text-gray-300"},"Ending within 30 days",-1)),t("div",C,i(n.overview.ending_soon),1)]),t("div",D,[e[4]||(e[4]=t("div",{class:"text-sm text-gray-300"},"Late",-1)),t("div",S,i(n.overview.late),1)]),t("div",E,[e[5]||(e[5]=t("div",{class:"text-sm text-gray-300"},"Requires invoicing",-1)),t("div",A,i(n.overview.requires_invoicing),1)]),t("div",B,[e[6]||(e[6]=t("div",{class:"text-sm text-gray-300"},"Action Required",-1)),t("div",O,i(n.overview.action_required),1)]),t("div",j,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-300"},"Unscheduled",-1)),t("div",F,i(n.overview.unscheduled),1)])])]),t("div",L,[t("div",q,[t("div",N,[t("div",null,[e[8]||(e[8]=t("h2",{class:"text-lg font-semibold text-white"},"All tasks",-1)),t("div",P,"("+i(l.filteredTasks.length)+" results)",1)])])]),t("div",R,[t("div",U,[t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Status",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.filters.status=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...e[9]||(e[9]=[u('<option value="all">All</option><option value="Open">Open</option><option value="Working">Working</option><option value="Completed">Completed</option><option value="Cancelled">Cancelled</option>',5)])],512),[[g,n.filters.status]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Priority",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.filters.priority=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...e[11]||(e[11]=[u('<option value="all">All</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option><option value="Urgent">Urgent</option>',5)])],512),[[g,n.filters.priority]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Type",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.filters.type=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...e[13]||(e[13]=[t("option",{value:"all"},"All",-1),t("option",{value:"One-off job"},"One-off job",-1),t("option",{value:"Recurring job"},"Recurring job",-1),t("option",{value:"Maintenance"},"Maintenance",-1)])],512),[[g,n.filters.type]])])])]),t("div",M,[t("table",V,[e[16]||(e[16]=t("thead",{class:"bg-[#315566] border-b border-[#315566]"},[t("tr",null,[t("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Task"),t("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Priority"),t("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Schedule"),t("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Status"),t("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Total")])],-1)),t("tbody",H,[l.filteredTasks.length===0?(c(),d("tr",W,[...e[15]||(e[15]=[t("td",{colspan:"5",class:"text-center py-8 text-gray-400"}," No tasks found ",-1)])])):x("",!0),(c(!0),d(h,null,_(l.filteredTasks,o=>(c(),d("tr",{key:o.name,class:"hover:bg-[#315566] cursor-pointer transition-colors group",onClick:dt=>l.viewTask(o.name)},[t("td",I,[t("div",J,[t("div",{class:m(["flex-shrink-0 w-2 h-2 rounded-full",l.getStatusColor(o.status)])},null,2),t("div",null,[t("div",X,i(o.subject),1),t("div",G,"#"+i(o.name)+" â€¢ "+i(o.type),1),t("div",K,[o.exp_start_date&&o.exp_end_date?(c(),d("span",Q,i(l.formatDate(o.exp_start_date))+" - "+i(l.formatDate(o.exp_end_date)),1)):o.exp_start_date?(c(),d("span",Y," Starts "+i(l.formatDate(o.exp_start_date)),1)):(c(),d("span",Z,"No dates set"))])])])]),t("td",$,[t("span",{class:m(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",l.getPriorityClass(o.priority)])},i(o.priority),3)]),t("td",tt,[t("div",et,i(o.actual_time||0)+" hrs logged",1),t("div",st,"Progress: "+i(o.progress)+"%",1)]),t("td",ot,[t("div",rt,[t("span",{class:m(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",l.getStatusClass(o.status)])},i(o.status),3),l.isLate(o)?(c(),d("span",it," Late ")):x("",!0)])]),t("td",nt,[t("div",lt,i(l.formatCurrency(o.total_billing_amount)),1)])],8,z))),128))])])])])])])}const ut=f(b,[["render",at]]);export{ut as default};
//# sourceMappingURL=Tasks-fe64c106.js.map
