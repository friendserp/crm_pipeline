import{E as I}from"./EditIcon-00e6e25e.js";import{F as q}from"./FieldLayout-d6697801.js";import{u as B}from"./UserAvatar-0be15b99.js";import{s as O}from"./statuses-d74d988d.js";import{J as Q,aR as F,K as U,a5 as T,r as h,j as X,X as M,b as z,U as _,l as c,C as d,D as A,M as n,N as J,L as u,q as v,I as w,aX as K,x as P}from"./index-f283a836.js";import{i as W}from"./DragVerticalIcon-2abb2b05.js";import{u as $,c as G,q as H}from"./modals-e50c2257.js";import{u as Y}from"./helpCenter-afdfc8c0.js";const Z={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ee={class:"mb-5 flex items-center justify-between"},ae={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},se={class:"flex items-center gap-1"},te={class:"px-4 pb-7 pt-4 sm:px-6"},oe={class:"flex flex-row-reverse gap-2"},pe={__name:"LeadModal",props:Q({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const E=b,{user:k}=F(),{getUser:x,isManager:L}=B(),{getLeadStatus:C,statusOptions:N}=O(),{updateOnboardingStep:S}=Y("frappecrm"),r=U(b,"modelValue"),V=T(),s=h(null),i=h(!1),{document:e,triggerOnBeforeCreate:m}=$("CRM Lead"),p=X(()=>{var t;let a=N("lead");return e.doc.status||(e.doc.status=(t=a==null?void 0:a[0])==null?void 0:t.value),a}),g=M({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(f=>{f.fields.forEach(l=>{l.fieldname=="status"&&(l.fieldtype="Select",l.options=p.value,l.prefix=C(e.doc.status).color),l.fieldtype==="Table"&&(e.doc[l.fieldname]=[])})})})})}),R=M({url:"frappe.client.insert"});async function j(){e.doc.website&&!e.doc.website.startsWith("http")&&(e.doc.website="https://"+e.doc.website),await(m==null?void 0:m()),R.submit({doc:{doctype:"CRM Lead",...e.doc}},{validate(){if(s.value=null,!e.doc.first_name)return s.value=__("First Name is mandatory"),s.value;if(e.doc.annual_revenue){if(typeof e.doc.annual_revenue=="string")e.doc.annual_revenue=e.doc.annual_revenue.replace(/,/g,"");else if(isNaN(e.doc.annual_revenue))return s.value=__("Annual Revenue should be a number"),s.value}if(e.doc.mobile_no&&isNaN(e.doc.mobile_no.replace(/[-+() ]/g,"")))return s.value=__("Mobile No should be a number"),s.value;if(e.doc.email&&!e.doc.email.includes("@"))return s.value=__("Invalid Email"),s.value;if(!e.doc.status)return s.value=__("Status is required"),s.value;i.value=!0},onSuccess(a){K("lead_created"),i.value=!1,r.value=!1,V.push({name:"Lead",params:{leadId:a.name}}),S("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+k,a.name)})},onError(a){if(i.value=!1,!a.messages){s.value=a.message;return}s.value=a.messages.join(`
`)}})}function D(){G.value=!0,H.value={doctype:"CRM Lead"},P(()=>r.value=!1)}return z(()=>{var a,t,o;e.doc={no_of_employees:"1-10"},Object.assign(e.doc,E.defaults),(a=e.doc)!=null&&a.lead_owner||(e.doc.lead_owner=x().name),!((t=e.doc)!=null&&t.status)&&((o=p.value[0])!=null&&o.value)&&(e.doc.status=p.value[0].value)}),(a,t)=>{const o=_("Button"),f=_("ErrorMessage"),l=_("Dialog");return c(),d(l,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=y=>r.value=y),options:{size:"3xl"}},{body:A(()=>[n("div",Z,[n("div",ee,[n("div",null,[n("h3",ae,J(a.__("Create Lead")),1)]),n("div",se,[u(L)()&&!u(W)?(c(),d(o,{key:0,variant:"ghost",class:"w-7",tooltip:a.__("Edit fields layout"),icon:I,onClick:D},null,8,["tooltip"])):v("",!0),w(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=y=>r.value=!1),icon:"x"})])]),n("div",null,[u(g).data?(c(),d(q,{key:0,tabs:u(g).data,data:u(e).doc},null,8,["tabs","data"])):v("",!0),s.value?(c(),d(f,{key:1,class:"mt-4",message:a.__(s.value)},null,8,["message"])):v("",!0)])]),n("div",te,[n("div",oe,[w(o,{variant:"solid",label:a.__("Create"),loading:i.value,onClick:j},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{pe as _};
//# sourceMappingURL=LeadModal-14056b60.js.map
