import{F as I}from"./FieldLayout-d12c6a75.js";import{E as B}from"./EditIcon-d1ec43fb.js";import{u as N}from"./UserAvatar-7e2b021e.js";import{i as j}from"./settings-dc117b2e.js";import{u as D,s as Q,a as A,c as O,q as T}from"./modals-49388916.js";import{_ as q,M as F,a5 as L,N as P,r as R,Y as S,o as U,B as b,V as v,g as m,G as p,H as Y,b as n,t as z,O as d,e as h,L as C,aT as G,aY as H}from"./index-07f63b4e.js";const $={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},J={class:"mb-5 flex items-center justify-between"},K={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},W={class:"flex items-center gap-1"},X={class:"px-4 pb-7 pt-4 sm:px-6"},Z={class:"space-y-2"},ee={__name:"ContactModal",props:F({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const c=_,{isManager:g}=N(),k=L(),l=P(_,"modelValue"),x=R(!1),{document:e,triggerOnBeforeCreate:r}=D("Contact");async function M(){e.doc.email_id&&(e.doc.email_ids=[{email_id:e.doc.email_id,is_primary:1}],delete e.doc.email_id),e.doc.mobile_no&&(e.doc.phone_nos=[{phone:e.doc.mobile_no,is_primary_mobile_no:1}],delete e.doc.mobile_no),await(r==null?void 0:r());const t=await G("frappe.client.insert",{doc:{doctype:"Contact",...e.doc}});t.name&&(H("contact_created"),w(t))}function w(t){var a,s;(s=(a=c.contact)==null?void 0:a.reload)==null||s.call(a),t.name&&c.options.redirect&&k.push({name:"Contact",params:{contactId:t.name}}),l.value=!1,c.options.afterInsert&&c.options.afterInsert(t)}const f=S({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:t=>t.forEach(a=>{a.sections.forEach(s=>{s.columns.forEach(u=>{u.fields.forEach(o=>{o.fieldname=="email_id"||o.fieldname=="mobile_no"?o.read_only=!1:o.fieldname=="address"?(o.create=(i,V)=>{e.doc.address=i,y(),V()},o.edit=i=>y(i)):o.fieldtype==="Table"&&(e.doc[o.fieldname]=[])})})})})});U(()=>{e.doc={},Object.assign(e.doc,c.contact.data||c.contact)});function E(){O.value=!0,T.value={doctype:"Contact"},b(()=>l.value=!1)}function y(t){Q.value=!0,A.value={doctype:"Address",address:t},b(()=>l.value=!1)}return(t,a)=>{const s=v("Button"),u=v("Dialog");return m(),p(u,{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value=o),options:{size:"xl"}},{body:Y(()=>{var o;return[n("div",$,[n("div",J,[n("div",null,[n("h3",K,z(t.__("New Contact")),1)]),n("div",W,[d(g)()&&!d(j)?(m(),p(s,{key:0,variant:"ghost",class:"w-7",tooltip:t.__("Edit fields layout"),icon:B,onClick:E},null,8,["tooltip"])):h("",!0),C(s,{variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=i=>l.value=!1),icon:"x"})])]),(o=d(f).data)!=null&&o.length?(m(),p(I,{key:0,tabs:d(f).data,data:d(e).doc,doctype:"Contact"},null,8,["tabs","data"])):h("",!0)]),n("div",X,[n("div",Z,[C(s,{class:"w-full",variant:"solid",label:t.__("Create"),loading:x.value,onClick:M},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},le=q(ee,[["__scopeId","data-v-179103b7"]]);export{le as C};
//# sourceMappingURL=ContactModal-bf7bba79.js.map
