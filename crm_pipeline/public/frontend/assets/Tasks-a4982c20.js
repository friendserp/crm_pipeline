import{_ as f,a as d,b as e,t as i,J as a,a2 as c,d as x,e as m,F as y,f as w,a4 as h,a3 as g,n as b,aE as v,g as u}from"./index-07f63b4e.js";const _={name:"Tasks",data(){return{tasks:[],timesheets:[],filters:{status:"all",priority:"all",type:"all"},overview:{ending_soon:0,late:0,requires_invoicing:0,action_required:0,unscheduled:0},loading:!1,showCreateModal:!1,isCreating:!1,newTask:{subject:"",type:"One-off job",priority:"Medium",status:"Open",exp_start_date:"",exp_end_date:"",description:"",expected_time:0,progress:0,company:"Friends ERP"}}},computed:{filteredTasks(){return this.tasks.filter(s=>!(this.filters.status!=="all"&&s.status!==this.filters.status||this.filters.priority!=="all"&&s.priority!==this.filters.priority||this.filters.type!=="all"&&s.type!==this.filters.type))},recentTimesheets(){const s=new Date;return s.setDate(s.getDate()-30),this.timesheets.filter(t=>{var p;return t.start_date?new Date(t.start_date)>=s&&((p=t.time_logs)==null?void 0:p.some(r=>r.task)):!1}).map(t=>{var r,l;const n=(l=(r=t.time_logs)==null?void 0:r.find(o=>o.task))==null?void 0:l.task,p=this.tasks.find(o=>o.name===n);return{...t,task_name:p?p.subject:"Unknown Task"}}).slice(0,5)}},async mounted(){await this.loadData()},watch:{filters:{handler(){this.calculateOverview()},deep:!0}},methods:{viewTask(s){this.$router.push(`/tasks/${s}`)},async loadData(){this.loading=!0;try{await Promise.all([this.loadTasks(),this.loadTimesheets()])}catch(s){console.error("Error loading data:",s)}finally{this.loading=!1}},async loadTasks(){try{const s=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Task",fields:["*"],limit_page_length:100,order_by:"modified desc"})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();this.tasks=t.message||[],this.calculateOverview()}catch(s){console.error("Error loading tasks:",s)}},async loadTimesheets(){try{const s=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doctype:"Timesheet",fields:["name","start_date","end_date","status","total_hours","time_logs"],limit_page_length:50,order_by:"start_date desc"})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();this.timesheets=t.message||[]}catch(s){console.error("Error loading timesheets:",s)}},async createTask(){if(!this.newTask.subject.trim()){this.showAlert("Please enter a task subject","red");return}this.isCreating=!0;try{const s=await fetch("/api/method/frappe.client.insert",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({doc:{doctype:"Task",subject:this.newTask.subject,type:this.newTask.type,priority:this.newTask.priority,status:this.newTask.status,exp_start_date:this.newTask.exp_start_date||void 0,exp_end_date:this.newTask.exp_end_date||void 0,description:this.newTask.description,expected_time:parseFloat(this.newTask.expected_time)||0,progress:parseFloat(this.newTask.progress)||0,company:this.newTask.company}})});if(s.ok){const t=await s.json();this.showAlert("Task created successfully!","green"),this.showCreateModal=!1,this.resetNewTask(),await this.loadTasks()}else{const t=await s.json();throw new Error(t.message||"Failed to create task")}}catch(s){console.error("Error creating task:",s),this.showAlert("Error creating task: "+s.message,"red")}finally{this.isCreating=!1}},resetNewTask(){this.newTask={subject:"",type:"One-off job",priority:"Medium",status:"Open",exp_start_date:"",exp_end_date:"",description:"",expected_time:0,progress:0,company:"Friends ERP"}},showAlert(s,t){const n=document.createElement("div");n.className=`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${t==="green"?"bg-green-500 text-white":"bg-red-500 text-white"}`,n.textContent=s,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},3e3)},getCSRFToken(){var s;return((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},calculateOverview(){const s=new Date,t=new Date(s);t.setDate(t.getDate()+30),this.overview={ending_soon:this.tasks.filter(n=>{if(!n.exp_end_date)return!1;const p=new Date(n.exp_end_date);return p<=t&&p>=s&&n.status!=="Completed"}).length,late:this.tasks.filter(n=>this.isLate(n)).length,requires_invoicing:this.tasks.filter(n=>n.total_billing_amount>0&&n.status==="Completed").length,action_required:this.tasks.filter(n=>["Open","Working"].includes(n.status)&&(n.progress===0||this.isLate(n))).length,unscheduled:this.tasks.filter(n=>!n.exp_start_date&&!n.exp_end_date).length}},isLate(s){return!s.exp_end_date||["Completed","Cancelled"].includes(s.status)?!1:new Date(s.exp_end_date)<new Date},getStatusClass(s){return{Open:"bg-blue-900 text-blue-200",Working:"bg-yellow-900 text-yellow-200",Completed:"bg-green-900 text-green-200",Cancelled:"bg-red-900 text-red-200",Overdue:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},getStatusColor(s){return{Open:"bg-blue-500",Working:"bg-yellow-500",Completed:"bg-green-500",Cancelled:"bg-red-500",Overdue:"bg-red-500"}[s]||"bg-gray-500"},getPriorityClass(s){return{Low:"bg-green-900 text-green-200",Medium:"bg-yellow-900 text-yellow-200",High:"bg-orange-900 text-orange-200",Urgent:"bg-red-900 text-red-200"}[s]||"bg-gray-700 text-gray-300"},formatDate(s){if(!s)return"No date";try{return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid date"}},formatCurrency(s){return`ETB ${parseFloat(s||0).toFixed(2)}`}}},k={class:"w-full bg-[#233d48]"},T={class:"bg-[#233d48] border-b border-[#2a4a58]"},C={class:"container mx-auto px-6 py-4"},E={class:"flex justify-between items-center"},j={class:"container mx-auto px-6 py-6"},D={class:"mb-8"},A={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},S={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},O={class:"text-xl font-semibold text-white"},B={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},F={class:"text-xl font-semibold text-red-400"},M={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},U={class:"text-xl font-semibold text-white"},V={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},P={class:"text-xl font-semibold text-white"},N={class:"bg-[#2a4a58] rounded-lg border border-[#315566] p-4 hover:border-[#2E86AB] transition-colors"},R={class:"text-xl font-semibold text-white"},L={class:"bg-[#2a4a58] rounded-lg border border-[#315566]"},q={class:"p-6 border-b border-[#315566]"},H={class:"flex justify-between items-center"},J={class:"text-sm text-gray-300 mt-1"},z={class:"p-6 border-b border-[#315566] bg-[#315566]"},W={class:"flex flex-wrap gap-6"},X={class:"overflow-x-auto"},I={class:"w-full"},G={class:"divide-y divide-[#315566]"},K={key:0},Q=["onClick"],Y={class:"py-4 px-6"},Z={class:"flex items-center space-x-3"},$={class:"font-medium text-white group-hover:text-[#2E86AB] transition-colors"},ee={class:"text-sm text-gray-400 mt-1"},te={class:"text-sm text-gray-400 mt-1"},se={key:0},oe={key:1},re={key:2},ne={class:"py-4 px-6"},ie={class:"py-4 px-6"},le={class:"text-sm text-white"},ae={class:"text-sm text-gray-400"},de={class:"py-4 px-6"},ue={class:"flex items-center gap-2"},pe={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-900 text-red-200"},ce={class:"py-4 px-6"},ge={class:"font-medium text-white"},me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},be={class:"bg-[#2a4a58] rounded-lg shadow-xl w-full max-w-2xl border border-[#315566]"},xe={class:"p-6"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},ye={class:"mb-6"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},he={class:"flex justify-end space-x-3 pt-4 border-t border-[#315566]"},ve=["disabled"],_e={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"};function ke(s,t,n,p,r,l){return u(),d("div",k,[e("div",T,[e("div",C,[e("div",E,[t[15]||(t[15]=e("h1",{class:"text-2xl font-bold text-white"},"Jobs",-1)),e("button",{onClick:t[0]||(t[0]=o=>r.showCreateModal=!0),class:"bg-[#2E86AB] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#257195] transition-colors"}," Create Job ")])])]),e("div",j,[e("div",D,[e("div",A,[e("div",S,[t[16]||(t[16]=e("div",{class:"text-sm text-gray-300"},"Ending within 30 days",-1)),e("div",O,i(r.overview.ending_soon),1)]),e("div",B,[t[17]||(t[17]=e("div",{class:"text-sm text-gray-300"},"Late",-1)),e("div",F,i(r.overview.late),1)]),e("div",M,[t[18]||(t[18]=e("div",{class:"text-sm text-gray-300"},"Requires invoicing",-1)),e("div",U,i(r.overview.requires_invoicing),1)]),e("div",V,[t[19]||(t[19]=e("div",{class:"text-sm text-gray-300"},"Action Required",-1)),e("div",P,i(r.overview.action_required),1)]),e("div",N,[t[20]||(t[20]=e("div",{class:"text-sm text-gray-300"},"Unscheduled",-1)),e("div",R,i(r.overview.unscheduled),1)])])]),e("div",L,[e("div",q,[e("div",H,[e("div",null,[t[21]||(t[21]=e("h2",{class:"text-lg font-semibold text-white"},"All tasks",-1)),e("div",J,"("+i(l.filteredTasks.length)+" results)",1)])])]),e("div",z,[e("div",W,[e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Status",-1)),a(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.filters.status=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...t[22]||(t[22]=[x('<option value="all">All</option><option value="Open">Open</option><option value="Working">Working</option><option value="Completed">Completed</option><option value="Cancelled">Cancelled</option>',5)])],512),[[c,r.filters.status]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Priority",-1)),a(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.filters.priority=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...t[24]||(t[24]=[x('<option value="all">All</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option><option value="Urgent">Urgent</option>',5)])],512),[[c,r.filters.priority]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"text-sm text-gray-300 block mb-2 font-medium"},"Type",-1)),a(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.filters.type=o),class:"bg-[#233d48] border border-[#315566] text-white rounded-lg px-4 py-2 text-sm w-40 focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent"},[...t[26]||(t[26]=[e("option",{value:"all"},"All",-1),e("option",{value:"One-off job"},"One-off job",-1),e("option",{value:"Recurring job"},"Recurring job",-1),e("option",{value:"Maintenance"},"Maintenance",-1)])],512),[[c,r.filters.type]])])])]),e("div",X,[e("table",I,[t[29]||(t[29]=e("thead",{class:"bg-[#315566] border-b border-[#315566]"},[e("tr",null,[e("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Task"),e("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Priority"),e("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Schedule"),e("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Status"),e("th",{class:"text-left py-4 px-6 text-sm font-medium text-gray-300"},"Total")])],-1)),e("tbody",G,[l.filteredTasks.length===0?(u(),d("tr",K,[...t[28]||(t[28]=[e("td",{colspan:"5",class:"text-center py-8 text-gray-400"}," No tasks found ",-1)])])):m("",!0),(u(!0),d(y,null,w(l.filteredTasks,o=>(u(),d("tr",{key:o.name,class:"hover:bg-[#315566] cursor-pointer transition-colors group",onClick:Te=>l.viewTask(o.name)},[e("td",Y,[e("div",Z,[e("div",{class:b(["flex-shrink-0 w-2 h-2 rounded-full",l.getStatusColor(o.status)])},null,2),e("div",null,[e("div",$,i(o.subject),1),e("div",ee,"#"+i(o.name)+" • "+i(o.type),1),e("div",te,[o.exp_start_date&&o.exp_end_date?(u(),d("span",se,i(l.formatDate(o.exp_start_date))+" - "+i(l.formatDate(o.exp_end_date)),1)):o.exp_start_date?(u(),d("span",oe," Starts "+i(l.formatDate(o.exp_start_date)),1)):(u(),d("span",re,"No dates set"))])])])]),e("td",ne,[e("span",{class:b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",l.getPriorityClass(o.priority)])},i(o.priority),3)]),e("td",ie,[e("div",le,i(o.actual_time||0)+" hrs logged",1),e("div",ae,"Progress: "+i(o.progress)+"%",1)]),e("td",de,[e("div",ue,[e("span",{class:b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize",l.getStatusClass(o.status)])},i(o.status),3),l.isLate(o)?(u(),d("span",pe," Late ")):m("",!0)])]),e("td",ce,[e("div",ge,i(l.formatCurrency(o.total_billing_amount)),1)])],8,Q))),128))])])])])]),r.showCreateModal?(u(),d("div",me,[e("div",be,[t[43]||(t[43]=e("div",{class:"p-6 border-b border-[#315566] bg-[#315566]"},[e("h3",{class:"text-xl font-semibold text-white"},"Create New Job")],-1)),e("div",xe,[e("form",{onSubmit:t[14]||(t[14]=h((...o)=>l.createTask&&l.createTask(...o),["prevent"]))},[e("div",fe,[e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Subject *",-1)),a(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>r.newTask.subject=o),required:"",class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white",placeholder:"Enter task subject"},null,512),[[g,r.newTask.subject]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Type",-1)),a(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.newTask.type=o),class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white"},[...t[31]||(t[31]=[e("option",{value:"One-off job"},"One-off job",-1),e("option",{value:"Recurring job"},"Recurring job",-1),e("option",{value:"Maintenance"},"Maintenance",-1)])],512),[[c,r.newTask.type]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Priority",-1)),a(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>r.newTask.priority=o),class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white"},[...t[33]||(t[33]=[e("option",{value:"Low"},"Low",-1),e("option",{value:"Medium"},"Medium",-1),e("option",{value:"High"},"High",-1),e("option",{value:"Urgent"},"Urgent",-1)])],512),[[c,r.newTask.priority]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Status",-1)),a(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>r.newTask.status=o),class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white"},[...t[35]||(t[35]=[e("option",{value:"Open"},"Open",-1),e("option",{value:"Working"},"Working",-1),e("option",{value:"Completed"},"Completed",-1),e("option",{value:"Cancelled"},"Cancelled",-1)])],512),[[c,r.newTask.status]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Start Date",-1)),a(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=o=>r.newTask.exp_start_date=o),class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white"},null,512),[[g,r.newTask.exp_start_date]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"End Date",-1)),a(e("input",{type:"date","onUpdate:modelValue":t[9]||(t[9]=o=>r.newTask.exp_end_date=o),class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white"},null,512),[[g,r.newTask.exp_end_date]])])]),e("div",ye,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),a(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>r.newTask.description=o),rows:"4",class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white",placeholder:"Enter task description"},null,512),[[g,r.newTask.description]])]),e("div",we,[e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Expected Time (hours)",-1)),a(e("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=o=>r.newTask.expected_time=o),step:"0.5",min:"0",class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white",placeholder:"0.0"},null,512),[[g,r.newTask.expected_time]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Progress (%)",-1)),a(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=o=>r.newTask.progress=o),min:"0",max:"100",class:"w-full px-3 py-2 border border-[#315566] rounded-md focus:outline-none focus:ring-2 focus:ring-[#2E86AB] focus:border-transparent bg-[#233d48] text-white",placeholder:"0"},null,512),[[g,r.newTask.progress]])])]),e("div",he,[e("button",{type:"button",onClick:t[13]||(t[13]=o=>r.showCreateModal=!1),class:"px-4 py-2 border border-[#315566] text-gray-300 bg-transparent hover:bg-[#233d48] font-medium rounded-md transition-colors duration-200"}," Cancel "),e("button",{type:"submit",disabled:r.isCreating,class:b(["px-4 py-2 font-medium rounded-md transition-colors duration-200 flex items-center",r.isCreating?"bg-gray-500 cursor-not-allowed":"bg-[#2E86AB] hover:bg-[#257195] text-white"])},[r.isCreating?(u(),d("svg",_e,[...t[42]||(t[42]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),v(" "+i(r.isCreating?"Creating...":"Create Job"),1)],10,ve)])],32)])])])):m("",!0)])}const Ee=f(_,[["render",ke]]);export{Ee as default};
//# sourceMappingURL=Tasks-a4982c20.js.map
