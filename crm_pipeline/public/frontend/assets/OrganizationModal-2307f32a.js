import{F as V}from"./FieldLayout-d12c6a75.js";import{E as R}from"./EditIcon-d1ec43fb.js";import{u as B}from"./UserAvatar-7e2b021e.js";import{i as I}from"./settings-dc117b2e.js";import{u as N,s as j,a as D,c as Q,q as A}from"./modals-49388916.js";import{M as T,a5 as q,N as F,r as E,Y as L,o as P,V as _,g as m,G as f,H as S,b as n,t as U,O as c,e as y,L as k,aT as Y,aY as G,B as H}from"./index-07f63b4e.js";const $={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},J={class:"flex items-center justify-between mb-5"},K={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},W={class:"flex items-center gap-1"},X={class:"px-4 pt-4 pb-7 sm:px-6"},Z={class:"space-y-2"},re={__name:"OrganizationModal",props:T({data:{type:Object,default:()=>({})},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const d=v,{isManager:z}=B(),O=q(),l=F(v,"modelValue"),u=E(!1),p=E(null),{document:r,triggerOnBeforeCreate:g}=N("CRM Organization");async function w(){u.value=!0,p.value=null,await(g==null?void 0:g());const e=await Y("frappe.client.insert",{doc:{doctype:"CRM Organization",...r.doc}},{onError:a=>{var o,i;a.error.exc_type=="ValidationError"&&(p.value=(i=(o=a.error)==null?void 0:o.messages)==null?void 0:i[0],u.value=!1)}});u.value=!1,e.name&&(G("organization_created"),x(e))}function x(e){e.name&&d.options.redirect&&O.push({name:"Organization",params:{organizationId:e.name}}),l.value=!1,d.options.afterInsert&&d.options.afterInsert(e)}const M=L({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Organization"],params:{doctype:"CRM Organization",type:"Quick Entry"},auto:!0,transform:e=>e.forEach(a=>{a.sections.forEach(o=>{o.columns.forEach(i=>{i.fields.forEach(s=>{s.fieldname=="address"?(s.create=(t,h)=>{r.doc.address=t,b(),h()},s.edit=t=>b(t)):s.fieldtype==="Table"&&(r.doc[s.fieldname]=[])})})})})});P(()=>{r.doc={no_of_employees:"1-10"},Object.assign(r.doc,d.data)});function C(){Q.value=!0,A.value={doctype:"CRM Organization"},H(()=>l.value=!1)}function b(e){j.value=!0,D.value={doctype:"Address",address:e}}return(e,a)=>{const o=_("Button"),i=_("ErrorMessage"),s=_("Dialog");return m(),f(s,{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value=t),options:{size:"xl"}},{body:S(()=>{var t;return[n("div",$,[n("div",J,[n("div",null,[n("h3",K,U(e.__("New Organization")),1)]),n("div",W,[c(z)()&&!c(I)?(m(),f(o,{key:0,variant:"ghost",class:"w-7",tooltip:e.__("Edit fields layout"),icon:R,onClick:C},null,8,["tooltip"])):y("",!0),k(o,{variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=h=>l.value=!1),icon:"x"})])]),(t=c(M).data)!=null&&t.length?(m(),f(V,{key:0,tabs:c(M).data,data:c(r).doc,doctype:"CRM Organization"},null,8,["tabs","data"])):y("",!0),p.value?(m(),f(i,{key:1,class:"mt-8",message:e.__(p.value)},null,8,["message"])):y("",!0)]),n("div",X,[n("div",Z,[k(o,{class:"w-full",variant:"solid",label:e.__("Create"),loading:u.value,onClick:w},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}};export{re as _};
//# sourceMappingURL=OrganizationModal-2307f32a.js.map
