import{_ as Z,g as H,a as j,b as m,r as v,l as F,b6 as T,c as S,Y as $,aT as E,M as U,N as B,a5 as z,v as G,B as J,V as x,G as O,H as D,t as A,O as p,e as I,L as R,aY as N}from"./index-07f63b4e.js";import{A as P}from"./ArrowUpRightIcon-ea6835ba.js";import{b as Y}from"./EditIcon-d1ec43fb.js";const q={},K={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Q(n,l){return H(),j("svg",K,[...l[0]||(l[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.99707 14H11.9971C12.8255 14 13.4971 13.3284 13.4971 12.5V6.49988L11 6.4999C10.1716 6.49991 9.5 5.82833 9.5 4.9999V2H3.99707C3.16864 2 2.49707 2.67157 2.49707 3.5V12.5C2.49707 13.3284 3.16864 14 3.99707 14ZM13.8291 4.2806C14.1476 4.62366 14.3612 5.04668 14.4502 5.49987L14.4968 5.49987L14.4968 5.94777L14.4971 5.98173V12.5C14.4971 13.8807 13.3778 15 11.9971 15H3.99707C2.61636 15 1.49707 13.8807 1.49707 12.5V3.5C1.49707 2.11929 2.61636 1 3.99707 1H9.69261C10.3878 1 11.0516 1.28945 11.5246 1.79887L13.8291 4.2806ZM11 5.4999L13.4176 5.49988C13.3502 5.30132 13.2414 5.11735 13.0963 4.96105L10.7918 2.47932C10.7044 2.38525 10.6063 2.30368 10.5 2.23582V4.9999C10.5 5.27604 10.7239 5.4999 11 5.4999ZM5 11C4.72386 11 4.5 11.2239 4.5 11.5C4.5 11.7761 4.72386 12 5 12H11C11.2761 12 11.5 11.7761 11.5 11.5C11.5 11.2239 11.2761 11 11 11H5ZM4.5 9C4.5 8.72386 4.72386 8.5 5 8.5H10H11C11.2761 8.5 11.5 8.72386 11.5 9C11.5 9.27614 11.2761 9.5 11 9.5H10H5C4.72386 9.5 4.5 9.27614 4.5 9Z",fill:"currentColor","fill-opacity":"0.72"},null,-1)])])}const de=Z(q,[["render",Q]]),W=v(!1),X=v(!1);function ee(){let l=new URLSearchParams(document.cookie.split("; ").join("&")).get("user_id");return l==="Guest"&&(l=null),l}const c=F({}),f=T("onboardingStatus",{});function te(n){const l=ee();if(!l||l==="Guest")return;const r=T("isOnboardingStepsCompleted"+n+l,!1),u=S(()=>{var e,o;return((o=(e=f.value)==null?void 0:e[l])==null?void 0:o[n+"_onboarding_status"])||[]});!u.value.length&&!r.value&&$({url:"frappe.onboarding.get_onboarding_status",cache:"onboarding_status",auto:!0,onSuccess:e=>{f.value[l]=e,t()}});const _=S(()=>{var e;return((e=c[n])==null?void 0:e.filter(o=>o.completed).length)||0}),h=S(()=>{var e;return((e=c[n])==null?void 0:e.length)||0}),L=S(()=>Math.floor(_.value/h.value*100));function k(e,o=null){s(e,!0,!0,o)}function C(e=null){M(!0,e)}function y(e,o=null){s(e,!1,!1,o)}function g(e=null){M(!1,e)}function s(e,o=!0,d=!1,b=null){if(r.value)return;u.value.length||(f.value[l]||(f.value[l]={}),f.value[l][n+"_onboarding_status"]=c[n].map(V=>({name:V.name,completed:!1})));let i=u.value.findIndex(V=>V.name===e);i!==-1&&(u.value[i].completed=o,c[n][i].completed=o),w(u.value),b==null||b(e,d),X.value=!1}function M(e,o=null){r.value&&e||(u.value.length?u.value.forEach(d=>{d.completed=e}):(f.value[l]||(f.value[l]={}),f.value[l][n+"_onboarding_status"]=c[n].map(d=>({name:d.name,completed:e}))),c[n].forEach(d=>{d.completed=e}),w(u.value),o==null||o(e))}function w(e){E("frappe.onboarding.update_user_onboarding_status",{steps:JSON.stringify(e),appName:n})}function t(){if(!r.value)if(u.value.length){let e=u.value;e.forEach((o,d)=>{c[n][d].completed=o.completed}),r.value=e.every(o=>o.completed)}else r.value=!1}function a(e){W.value=!r.value,!c[n]&&(c[n]=e,t())}return{steps:c[n],stepsCompleted:_,totalSteps:h,completedPercentage:L,isOnboardingStepsCompleted:r,updateOnboardingStep:s,skip:k,skipAll:C,reset:y,resetAll:g,setUp:a,syncStatus:t}}v(!1);const oe={class:"flex items-center gap-3"},ne={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},le={class:"flex flex-col gap-4"},ae={class:"mb-1.5 text-xs text-ink-gray-5"},se={class:"flex justify-end"},ce={__name:"NoteModal",props:U({note:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadNotes:{},reloadNotesModifiers:{}}),emits:U(["after"],["update:modelValue","update:reloadNotes"]),setup(n,{emit:l}){const r=n,u=B(n,"modelValue"),_=B(n,"reloadNotes"),h=l,L=z(),{updateOnboardingStep:k}=te("frappecrm"),C=v(null),y=v(null),g=v(!1);let s=v({});async function M(){var t,a;if(s.value.name){let e=await E("frappe.client.set_value",{doctype:"FCRM Note",name:s.value.name,fieldname:s.value});e.name&&((t=_.value)==null||t.reload(),h("after",e))}else{let e=await E("frappe.client.insert",{doc:{doctype:"FCRM Note",title:s.value.title,content:s.value.content,reference_doctype:r.doctype,reference_docname:r.doc||""}},{onError:o=>{o.error.exc_type=="MandatoryError"&&(C.value="Title is mandatory")}});e.name&&(k("create_first_note"),N("note_created"),(a=_.value)==null||a.reload(),h("after",e,!0))}u.value=!1}function w(){var e;if(!((e=r.note)!=null&&e.reference_docname))return;let t=r.note.reference_doctype=="CRM Deal"?"Deal":"Lead",a={leadId:r.note.reference_docname};t=="Deal"&&(a={dealId:r.note.reference_docname}),L.push({name:t,params:a})}return G(()=>u.value,t=>{t&&(g.value=!1,J(()=>{var a,e;(e=(a=y.value)==null?void 0:a.el)==null||e.focus(),s.value={...r.note},(s.value.title||s.value.content)&&(g.value=!0)}))}),(t,a)=>{const e=x("Button"),o=x("FormControl"),d=x("ErrorMessage"),b=x("Dialog");return H(),O(b,{modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=i=>u.value=i),options:{size:"xl"}},{"body-title":D(()=>{var i;return[m("div",oe,[m("h3",ne,A(g.value?t.__("Edit Note"):t.__("Create Note")),1),(i=p(s))!=null&&i.reference_docname?(H(),O(e,{key:0,size:"sm",label:p(s).reference_doctype=="CRM Deal"?t.__("Open Deal"):t.__("Open Lead"),iconRight:P,onClick:a[0]||(a[0]=V=>w())},null,8,["label"])):I("",!0)])]}),"body-content":D(()=>[m("div",le,[m("div",null,[R(o,{ref_key:"title",ref:y,label:t.__("Title"),modelValue:p(s).title,"onUpdate:modelValue":a[1]||(a[1]=i=>p(s).title=i),placeholder:t.__("Call with John Doe"),required:""},null,8,["label","modelValue","placeholder"])]),m("div",null,[m("div",ae,A(t.__("Content")),1),R(p(Y),{variant:"outline",ref:"content","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:p(s).content,onChange:a[2]||(a[2]=i=>p(s).content=i),placeholder:t.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),C.value?(H(),O(d,{key:0,class:"mt-4",message:t.__(C.value)},null,8,["message"])):I("",!0)])]),actions:D(()=>[m("div",se,[R(e,{label:g.value?t.__("Update"):t.__("Create"),variant:"solid",onClick:M},null,8,["label"])])]),_:1},8,["modelValue"])}}};export{de as N,ce as _,X as m,te as u};
//# sourceMappingURL=NoteModal-57ed802b.js.map
