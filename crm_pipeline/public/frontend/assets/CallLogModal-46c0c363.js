import{E as oe}from"./EditIcon-d1ec43fb.js";import{A as ue}from"./ArrowUpRightIcon-ea6835ba.js";import{_ as P,g as n,a as u,b as o,a5 as de,N as j,r as k,c as ne,a0 as K,ag as z,v as me,V as O,L as p,H as w,t as V,O as g,G as x,e as h,F as Y,f as se,a9 as _e,aE as pe,$ as ve,n as q,aT as J,B as ie,M as ge,Y as W,aY as fe,o as Ce,b0 as ye,aj as he,I as be}from"./index-07f63b4e.js";import{C as ke}from"./ContactsIcon-c8d300fb.js";import{L as Le}from"./LeadsIcon-d97be766.js";import{D as Me}from"./DealsIcon-dc1f8fc1.js";import{N as X,_ as xe}from"./NoteModal-57ed802b.js";import{T as ee}from"./TaskIcon-ee0f7b95.js";import{T as we}from"./TaskModal-0e11a83a.js";import{_ as ae}from"./FadedScrollableDiv-e9e34484.js";import{d as Ve,f as le,t as De,D as $e,b as te,u as Ie,g as Te}from"./UserAvatar-7e2b021e.js";import{i as re}from"./settings-dc117b2e.js";import{u as ce,c as Ee,q as Be}from"./modals-49388916.js";import{F as Ne}from"./FieldLayout-d12c6a75.js";const He={},Re={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Fe(s,a){return n(),u("svg",Re,[...a[0]||(a[0]=[o("g",{"clip-path":"url(#clip0_4750_5685)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.4375 6C10.4375 8.45076 8.45076 10.4375 6 10.4375C3.54924 10.4375 1.5625 8.45076 1.5625 6C1.5625 3.54924 3.54924 1.5625 6 1.5625C8.45076 1.5625 10.4375 3.54924 10.4375 6ZM11.4375 6C11.4375 9.00305 9.00305 11.4375 6 11.4375C2.99695 11.4375 0.5625 9.00305 0.5625 6C0.5625 2.99695 2.99695 0.5625 6 0.5625C9.00305 0.5625 11.4375 2.99695 11.4375 6ZM9.00005 5.50004C9.27619 5.50004 9.50004 5.72391 9.50004 6.00005C9.50004 6.27619 9.27618 6.50004 9.00003 6.50004L6.25001 6.5C5.8358 6.49999 5.50003 6.16421 5.50002 5.75L5.5 3C5.5 2.72386 5.72385 2.5 6 2.5C6.27614 2.5 6.5 2.72385 6.5 3L6.50002 5.5L9.00005 5.50004Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_4750_5685"},[o("rect",{width:"12",height:"12",fill:"white"})])],-1)])])}const Ae=P(He,[["render",Fe]]),je={},Oe={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Pe(s,a){return n(),u("svg",Oe,[...a[0]||(a[0]=[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.5 1C4.77614 1 5 1.22386 5 1.5V2.5L5 2.50056C5.15613 2.5 5.32244 2.5 5.5 2.5H10.5C10.6776 2.5 10.8439 2.5 11 2.50056C11 2.50037 11 2.50019 11 2.5V1.5C11 1.22386 11.2239 1 11.5 1C11.7761 1 12 1.22386 12 1.5V2.5C12 2.50803 11.9998 2.51602 11.9994 2.52395C12.49 2.55387 12.838 2.62116 13.135 2.77248C13.6054 3.01217 13.9878 3.39462 14.2275 3.86502C14.5 4.3998 14.5 5.09987 14.5 6.5V10.5C14.5 11.9001 14.5 12.6002 14.2275 13.135C13.9878 13.6054 13.6054 13.9878 13.135 14.2275C12.6002 14.5 11.9001 14.5 10.5 14.5H5.5C4.09987 14.5 3.3998 14.5 2.86502 14.2275C2.39462 13.9878 2.01217 13.6054 1.77248 13.135C1.5 12.6002 1.5 11.9001 1.5 10.5V6.5C1.5 5.09987 1.5 4.3998 1.77248 3.86502C2.01217 3.39462 2.39462 3.01217 2.86502 2.77248C3.16202 2.62116 3.51 2.55387 4.00056 2.52395C4.00019 2.51602 4 2.50803 4 2.5V1.5C4 1.22386 4.22386 1 4.5 1ZM5.5 3.5H10.5C11.2166 3.5 11.6938 3.50078 12.0606 3.53074C12.4156 3.55975 12.5781 3.61105 12.681 3.66349C12.9632 3.8073 13.1927 4.03677 13.3365 4.31901C13.389 4.42194 13.4403 4.5844 13.4693 4.93944C13.4916 5.21337 13.4977 5.54901 13.4994 6H2.50061C2.50226 5.54901 2.50836 5.21337 2.53074 4.93944C2.55975 4.5844 2.61105 4.42194 2.66349 4.31901C2.8073 4.03677 3.03677 3.8073 3.31901 3.66349C3.42194 3.61105 3.5844 3.55975 3.93944 3.53074C4.30615 3.50078 4.78343 3.5 5.5 3.5ZM2.5 7V10.5C2.5 11.2166 2.50078 11.6939 2.53074 12.0606C2.55975 12.4156 2.61105 12.5781 2.66349 12.681C2.8073 12.9632 3.03677 13.1927 3.31901 13.3365C3.42194 13.389 3.5844 13.4403 3.93944 13.4693C4.30615 13.4992 4.78343 13.5 5.5 13.5H10.5C11.2166 13.5 11.6938 13.4992 12.0606 13.4693C12.4156 13.4403 12.5781 13.389 12.681 13.3365C12.9632 13.1927 13.1927 12.9632 13.3365 12.681C13.389 12.5781 13.4403 12.4156 13.4693 12.0606C13.4992 11.6939 13.5 11.2166 13.5 10.5V7H2.5Z",fill:"currentColor"},null,-1)])])}const Ze=P(je,[["render",Pe]]),Se={},Qe={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ue(s,a){return n(),u("svg",Qe,[...a[0]||(a[0]=[o("g",{"clip-path":"url(#clip0_3668_69185)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_3668_69185"},[o("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const ze=P(Se,[["render",Ue]]),{getFormattedPercent:qe,getFormattedFloat:Je,getFormattedCurrency:Ye}=Ve("CRM Call Log");function Ge(s,a,C=[]){var m,v,_,L,b;let f=a.type==="Incoming";if(s==="duration")return{label:a._duration,icon:"clock"};if(s==="caller")return{label:(m=a._caller)==null?void 0:m.label,image:(v=a._caller)==null?void 0:v.image};if(s==="receiver")return{label:(_=a._receiver)==null?void 0:_.label,image:(L=a._receiver)==null?void 0:L.image};if(s==="type")return{label:a.type,icon:f?"phone-incoming":"phone-outgoing"};if(s==="status")return{label:Ke[a.status],color:We[a.status]};if(["modified","creation"].includes(s))return{label:le(a[s]),timeAgo:__(De(a[s]))};let c=(b=C==null?void 0:C.find(M=>(M.key||M.value)==s))==null?void 0:b.type;return c&&["Date","Datetime"].includes(c)?le(a[s],"",!0,c=="Datetime"):c&&c=="Currency"?Ye(s,a):c&&c=="Float"?Je(s,a):c&&c=="Percent"?qe(s,a):a[s]}const Ke={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Canceled:"Canceled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},We={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Canceled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"};const Xe={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ea={class:"mb-5 flex items-center justify-between"},aa={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},la={class:"flex items-center gap-1"},ta={class:"flex flex-col gap-3.5"},oa={class:"grid size-7 place-content-center"},na={class:"flex min-h-7 w-full items-center gap-2"},sa={key:0,class:"flex items-center gap-1"},ia={class:"ml-1 flex flex-col gap-1"},ra={class:"ml-1 flex flex-col gap-1"},ca={key:2,class:"w-full"},ua=["src"],da=["innerHTML"],ma=["innerHTML"],_a=["innerHTML"],pa=["innerHTML"],va={key:6},ga={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},fa={__name:"CallLogDetailModal",props:{modelValue:{},modelModifiers:{},callLog:{},callLogModifiers:{},callLogModal:{},callLogModalModifiers:{}},emits:["update:modelValue","update:callLog","update:callLogModal"],setup(s){const a=de(),C=j(s,"modelValue"),f=k(!1),c=k(!1),m=j(s,"callLog"),v=k({title:"",content:""}),_=k({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),L=ne(()=>{var i,d,r,D,$,I;if(!((i=m.value)!=null&&i.data))return[];let e=JSON.parse(JSON.stringify((d=m.value)==null?void 0:d.data));for(const y in e)e[y]=Ge(y,e);return v.value=((r=e._notes)==null?void 0:r[0])??null,_.value=((D=e._tasks)==null?void 0:D[0])??null,[{icon:K(z,{name:e.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:e.type.label+" Call"},{icon:ke,name:"receiver",value:{receiver:e.receiver,caller:e.caller}},{icon:e._lead?Le:Me,name:"reference_doc",value:e._lead?"Lead":"Deal",link:()=>{e._lead?a.push({name:"Lead",params:{leadId:e._lead}}):a.push({name:"Deal",params:{dealId:e._deal}})},condition:()=>e._lead||e._deal},{icon:Ze,name:"creation",value:e.creation.label,tooltip:e.creation.label},{icon:Ae,name:"duration",value:e.duration.label},{icon:ze,name:"status",value:e.status.label,color:e.status.color},{icon:K(z,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:e.recording_url},{icon:X,name:"note",value:(($=e._notes)==null?void 0:$[0])??null},{icon:ee,name:"task",value:((I=e._tasks)==null?void 0:I[0])??null}].filter(y=>y.value).filter(y=>y.condition?y.condition():!0)}),b=k({}),M=k({});async function R(){var e,l,i,d;await((i=(l=b.value).triggerOnCreateLead)==null?void 0:i.call(l,(e=m.value)==null?void 0:e.data,M.value,()=>C.value=!1)),J("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:(d=m.value)==null?void 0:d.data,lead_details:M.value}).then(r=>{r&&a.push({name:"Lead",params:{leadId:r}})})}const Z=j(s,"callLogModal");function S(){Z.value=!0,ie(()=>{C.value=!1})}function Q(){var e;(e=v.value)!=null&&e.name||(v.value={title:"",content:""}),f.value=!0}function F(){var e;(e=_.value)!=null&&e.name||(_.value={title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),c.value=!0}async function U(e,l=!1){var i,d;v.value=e,l&&e.name&&await J("crm.integrations.api.add_note_to_call_log",{call_sid:(d=(i=m.value)==null?void 0:i.data)==null?void 0:d.id,note:e})}async function A(e,l=!1){var i,d;_.value=e,l&&e.name&&await J("crm.integrations.api.add_task_to_call_log",{call_sid:(d=(i=m.value)==null?void 0:i.data)==null?void 0:d.id,task:e})}return me(()=>{var e,l;return(l=(e=m.value)==null?void 0:e.data)==null?void 0:l.name},e=>{e&&(b.value=ce("CRM Call Log",e))}),(e,l)=>{const i=O("Button"),d=O("Dialog");return n(),u(Y,null,[p(d,{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=r=>C.value=r)},{body:w(()=>{var r,D,$,I,y,G;return[o("div",Xe,[o("div",ea,[o("div",null,[o("h3",aa,V(e.__("Call Details")),1)]),o("div",la,[p(g($e),{options:[{group:e.__("Options"),hideLabel:!0,items:[{label:(r=v.value)!=null&&r.name?e.__("Edit note"):e.__("Add note"),icon:X,onClick:Q},{label:(D=_.value)!=null&&D.name?e.__("Edit task"):e.__("Add task"),icon:ee,onClick:F}]}]},{default:w(()=>[p(i,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"]),g(re)?h("",!0):(n(),x(i,{key:0,variant:"ghost",tooltip:e.__("Edit call log"),icon:oe,class:"w-7",onClick:S},null,8,["tooltip"])),p(i,{icon:"x",variant:"ghost",class:"w-7",onClick:l[0]||(l[0]=t=>C.value=!1)})])]),o("div",ta,[(n(!0),u(Y,null,se(L.value,t=>(n(),u("div",{key:t.name,class:"flex gap-2 text-base text-ink-gray-8"},[o("div",oa,[(n(),x(_e(t.icon)))]),o("div",na,[t.name=="receiver"?(n(),u("div",sa,[p(g(te),{image:t.value.caller.image,label:t.value.caller.label,size:"sm"},null,8,["image","label"]),o("div",ia,V(t.value.caller.label),1),p(g(z),{name:"arrow-right",class:"mx-1 h-4 w-4 text-ink-gray-5"}),p(g(te),{image:t.value.receiver.image,label:t.value.receiver.label,size:"sm"},null,8,["image","label"]),o("div",ra,V(t.value.receiver.label),1)])):t.tooltip?(n(),x(g(ve),{key:1,text:t.tooltip},{default:w(()=>[pe(V(t.value),1)]),_:2},1032,["text"])):t.name=="recording_url"?(n(),u("div",ca,[o("audio",{class:"audio-control w-full",controls:"",src:t.value},null,8,ua)])):t.name=="note"?(n(),u("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:l[1]||(l[1]=()=>f.value=!0)},[p(ae,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:w(()=>{var T,E,B,N,H;return[(T=t.value)!=null&&T.title?(n(),u("div",{key:0,class:q([(E=t.value)!=null&&E.content?"mb-1 font-bold":""]),innerHTML:(B=t.value)==null?void 0:B.title},null,10,da)):h("",!0),(N=t.value)!=null&&N.content?(n(),u("div",{key:1,innerHTML:(H=t.value)==null?void 0:H.content},null,8,ma)):h("",!0)]}),_:2},1024)])):t.name=="task"?(n(),u("div",{key:4,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:l[2]||(l[2]=()=>c.value=!0)},[p(ae,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:w(()=>{var T,E,B,N,H;return[(T=t.value)!=null&&T.title?(n(),u("div",{key:0,class:q([(E=t.value)!=null&&E.description?"mb-1 font-bold":""]),innerHTML:(B=t.value)==null?void 0:B.title},null,10,_a)):h("",!0),(N=t.value)!=null&&N.description?(n(),u("div",{key:1,innerHTML:(H=t.value)==null?void 0:H.description},null,8,pa)):h("",!0)]}),_:2},1024)])):(n(),u("div",{key:5,class:q(t.color?`text-${t.color}-600`:"")},V(t.value),3)),t.link?(n(),u("div",va,[p(ue,{class:"h-4 w-4 shrink-0 cursor-pointer text-ink-gray-5 hover:text-ink-gray-8",onClick:()=>t.link()},null,8,["onClick"])])):h("",!0)])]))),128))])]),!((I=($=m.value)==null?void 0:$.data)!=null&&I._lead)&&!((G=(y=m.value)==null?void 0:y.data)!=null&&G._deal)?(n(),u("div",ga,[p(i,{class:"w-full",variant:"solid",label:e.__("Create lead"),onClick:R},null,8,["label"])])):h("",!0)]}),_:1},8,["modelValue"]),p(xe,{modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=r=>f.value=r),note:v.value,onAfter:U},null,8,["modelValue","note"]),p(we,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=r=>c.value=r),task:_.value,onAfter:A},null,8,["modelValue","task"])],64)}}},Oa=P(fa,[["__scopeId","data-v-1cb12bfd"]]),Ca={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},ya={class:"flex items-center justify-between mb-5"},ha={class:"flex items-center gap-2"},ba={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ka={class:"flex items-center gap-1"},La={key:0},Ma={class:"px-4 pt-4 pb-7 sm:px-6"},xa={class:"flex justify-end gap-2"},Pa={__name:"CallLogModal",props:ge({data:{type:Object,default:()=>({})},referenceDoc:{type:Object,default:()=>({})},options:{type:Object,default:{afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){var A;const a=s,{isManager:C}=Ie(),f=j(s,"modelValue"),c=k(!1),m=k(null),v=k(!1),{document:_,triggerOnBeforeCreate:L}=ce("CRM Call Log",((A=a.data)==null?void 0:A.name)||""),b=ne(()=>{let e=v.value?__("Edit Call Log"):__("New Call Log"),l="xl",i=[{label:v.value?__("Save"):__("Create"),variant:"solid",onClick:()=>v.value?Z():S()}];return{title:e,size:l,actions:i}}),M=W({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Call Log"],params:{doctype:"CRM Call Log",type:"Quick Entry"},auto:!0}),R={onSuccess:e=>{c.value=!1,F(e)},onError:e=>{if(c.value=!1,e.exc_type=="MandatoryError"){const l=e.messages.map(i=>{let d=i.split(": ");return d[d.length-1].trim()}).join(", ");m.value=__("These fields are required: {0}",[l]);return}m.value=e}};async function Z(){c.value=!0,await _.save.submit(null,R)}async function S(){Object.assign(_.doc,{doctype:"CRM Call Log",id:Te(6),telephony_medium:"Manual"}),await(L==null?void 0:L(a.referenceDoc)),await Q.submit({doc:_.doc})}const Q=W({url:"frappe.client.insert",onSuccess(e){c.value=!1,e.name&&(fe("call_log_created"),F(e))},onError(e){R.onError(e)}});function F(e){f.value=!1,a.options.afterInsert&&a.options.afterInsert(e)}Ce(()=>{var e,l;v.value=!!((e=a.data)!=null&&e.name),(l=a.data)!=null&&l.name||(_.doc={...a.data})});function U(){Ee.value=!0,Be.value={doctype:"CRM Call Log"},ie(()=>f.value=!1)}return(e,l)=>{const i=O("Button"),d=O("Dialog");return n(),x(d,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=r=>f.value=r),options:b.value},{body:w(()=>[o("div",Ca,[o("div",ya,[o("div",ha,[o("h3",ba,V(e.__(b.value.title)||e.__("Untitled")),1),g(_).isDirty?(n(),x(g(ye),{key:0,label:"Not Saved",theme:"orange"})):h("",!0)]),o("div",ka,[g(C)()&&!g(re)?(n(),x(i,{key:0,variant:"ghost",tooltip:e.__("Edit fields layout"),icon:oe,class:"w-7",onClick:U},null,8,["tooltip"])):h("",!0),p(i,{variant:"ghost",class:"w-7",onClick:l[0]||(l[0]=r=>f.value=!1),icon:"x"})])]),g(M).data?(n(),u("div",La,[p(Ne,{tabs:g(M).data,data:g(_).doc,doctype:"CRM Call Log"},null,8,["tabs","data"]),p(g(he),{class:"mt-8",message:m.value},null,8,["message"])])):h("",!0)]),o("div",Ma,[o("div",xa,[(n(!0),u(Y,null,se(b.value.actions,r=>(n(),x(i,be({class:"w-full",key:r.label},{ref_for:!0},r,{label:e.__(r.label),loading:c.value}),null,16,["label","loading"]))),128))])])]),_:1},8,["modelValue","options"])}}};export{Oa as C,Ae as D,Pa as _,Ze as a,We as b,Ge as g,Ke as s};
//# sourceMappingURL=CallLogModal-46c0c363.js.map
