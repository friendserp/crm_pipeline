import{f as ce}from"./DeleteLinkedDocModal-5c61d607.js";import{_ as me}from"./ErrorPage-f1492994.js";import{_ as de}from"./Resizer-71f2ec46.js";import{_ as ue}from"./Icon-8af02f75.js";import{g as _e,S as pe}from"./view-e30385f4.js";import{L as fe}from"./LayoutHeader-e14a2860.js";import{P as ge}from"./PhoneIcon-1fb4da28.js";import{C as ye}from"./CameraIcon-9082221f.js";import{D as ve}from"./DealsIcon-16554128.js";import{_ as be}from"./DealsListView-092e86be.js";import{u as he,d as A,f as we,t as Ce,b as U,D as ke,e as xe}from"./UserAvatar-34c53d4c.js";import{u as De,s as ze,a as Me,_ as Se}from"./modals-2ff32448.js";import{g as Ie}from"./settings-d4673873.js";import{g as Ve}from"./global-6174b3e1.js";import{o as $e}from"./organizations-8a88c526.js";import{s as Pe}from"./statuses-e1940a1a.js";import{c as O}from"./DragVerticalIcon-bf707ece.js";import{aU as Te,r as z,j as y,$ as qe,X as H,aT as M,aV as C,m as v,L as o,C as d,D as _,q as m,I as u,F as Ee,U as I,l,M as i,a9 as V,E as Le,N as b,aE as X,p as G}from"./index-d54876c1.js";import{_ as Ne}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c5c44673.js";import{F as Re}from"./FileUploader-3df49812.js";import{u as Be}from"./pageMeta-1e607448.js";import"./EditIcon-70eae3cf.js";import"./Link-ea1b258c.js";import"./FadedScrollableDiv-0d28074d.js";import"./ArrowUpRightIcon-1e1a48e6.js";import"./ListBulkActions-c260ba88.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-d79548f0.js";import"./MultipleAvatar-d00be64e.js";import"./ListFooter-a1579762.js";import"./TabButtons-8028c70a.js";import"./description-981c0dd5.js";const Fe={key:1,ref:"parentRef",class:"flex h-full"},je={class:"border-b"},Ae={class:"flex flex-col items-start justify-start gap-4 p-5"},Ue={class:"flex gap-4 items-center"},Oe={class:"group relative h-15.5 w-15.5"},He={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Xe={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Ge={class:"truncate text-2xl font-medium"},Je={key:0},Ke={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},Qe={class:""},We={class:"flex gap-1.5"},Ye={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ze={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ea={class:"flex flex-col items-center justify-center space-y-3"},Pa={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(J){const{brand:K}=Ie(),{makeCall:Q}=Ve(),{getUser:$}=he(),{getOrganization:P}=$e(),{getDealStatus:W}=Pe(),{doctypeMeta:Y}=A("Contact"),h=J,f=Te(),T=z(""),Z=z(""),{document:a}=De("Contact",h.contactId),ee=y(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(f.query.view||f.query.viewType){let n=_e(f.query.view,f.query.viewType,"Contact");n&&e.push({label:__(n.label),icon:n.icon,route:{name:"Contacts",params:{viewType:f.query.viewType},query:{view:f.query.view}}})}return e.push({label:q.value,route:{name:"Contact",params:{contactId:h.contactId}}}),e}),q=y(()=>{var n,s;let e=((n=Y.Contact)==null?void 0:n.title_field)||"name";return((s=a.doc)==null?void 0:s[e])||h.contactId});Be(()=>({title:q.value,icon:K.favicon}));const k=z(!1);async function ae(){k.value=!0}function E(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{C.success(__("Contact image updated"))}})}const L=z(0),te=[{label:"Deals",icon:qe(ve,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=x.data)==null?void 0:e.length})}],x=H({url:"crm.api.contact.get_linked_deals",cache:["deals",h.contactId],params:{contact:h.contactId},auto:!0}),S=y(()=>!x.data||x.data==[]?[]:x.data.map(e=>le(e))),D=H({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),oe=y(()=>D.data?D.data.map(e=>({...e,columns:e.columns.map(n=>({...n,fields:n.fields.map(s=>{var p,w;return s.fieldname==="email_id"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(r=>({name:r.name,value:r.email_id,selected:r.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>N("email",r.email_id),onSave:(t,c)=>c?R("email",t.value):B("Contact Email",t.name,"email_id",t.value),onDelete:async(t,c)=>{a.doc.email_ids=a.doc.email_ids.filter(g=>g.name!==t.name),c||await F("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="mobile_no"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((w=a.doc)==null?void 0:w.phone_nos)||[]).map(r=>({name:r.name,value:r.phone,selected:r.phone===a.doc.mobile_no,onClick:()=>N("mobile_no",r.phone),onSave:(t,c)=>c?R("phone",t.value):B("Contact Phone",t.name,"phone",t.value),onDelete:async(t,c)=>{a.doc.phone_nos=a.doc.phone_nos.filter(g=>g.name!==t.name),c||await F("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="address"?{...s,create:(r,t)=>{j(),t&&t()},edit:r=>j(r)}:s})}))})):[]);async function N(e,n){await M("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function R(e,n){if(!n)return;await M("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function B(e,n,s,p){await M("frappe.client.set_value",{doctype:e,name:n,fieldname:s,value:p})&&(a.reload(),C.success(__("Contact updated")))}async function F(e,n){await M("frappe.client.delete",{doctype:e,name:n}),await a.reload(),C.success(__("Contact updated"))}const{getFormattedCurrency:ne}=A("CRM Deal"),se=y(()=>re);function le(e){var n,s;return{name:e.name,organization:{label:e.organization,logo:(n=P(e.organization))==null?void 0:n.organization_logo},annual_revenue:ne("annual_revenue",e),status:{label:e.status,color:(s=W(e.status))==null?void 0:s.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&$(e.deal_owner).full_name,...e.deal_owner&&$(e.deal_owner)},modified:{label:we(e.modified),timeAgo:__(Ce(e.modified))}}}const re=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function j(e){ze.value=!0,Me.value={doctype:"Address",address:e}}return(e,n)=>{const s=I("ErrorMessage"),p=I("Button"),w=I("Badge"),r=ce;return l(),v(Ee,null,[o(a).doc?(l(),d(fe,{key:0},{"left-header":_(()=>[u(o(Ne),{items:ee.value},{prefix:_(({item:t})=>[t.icon?(l(),d(ue,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"])]),_:1})):m("",!0),o(a).doc?(l(),v("div",Fe,[o(a).doc?(l(),d(de,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:_(()=>[i("div",je,[u(o(Re),{onSuccess:E,validateFile:o(xe)},{default:_(({openFileSelector:t,error:c})=>{var g;return[i("div",Ae,[i("div",Ue,[i("div",Oe,[u(o(U),{size:"3xl",class:"h-15.5 w-15.5",label:o(a).doc.full_name,image:o(a).doc.image},null,8,["label","image"]),(l(),d(V(o(a).doc.image?o(ke):"div"),Le(o(a).doc.image?{options:[{icon:"upload",label:o(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>E("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:_(()=>[i("div",He,[u(ye,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),i("div",Xe,[i("div",Ge,[o(a).doc.salutation?(l(),v("span",Je,b(o(a).doc.salutation+". "),1)):m("",!0),i("span",null,b(o(a).doc.full_name),1)]),o(a).doc.company_name?(l(),v("div",Ke,[u(o(U),{size:"xs",label:o(a).doc.company_name,image:(g=o(P)(o(a).doc.company_name))==null?void 0:g.organization_logo},null,8,["label","image"]),i("span",Qe,b(o(a).doc.company_name),1)])):m("",!0),u(s,{message:e.__(c)},null,8,["message"])])]),i("div",We,[o(O)&&o(a).doc.mobile_no?(l(),d(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ge,onClick:n[0]||(n[0]=ie=>o(O)&&o(Q)(o(a).doc.mobile_no))},null,8,["label"])):m("",!0),u(p,{label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:n[1]||(n[1]=ie=>ae())},null,8,["label"])])])]}),_:1},8,["validateFile"])]),o(D).data?(l(),v("div",Ye,[u(pe,{sections:oe.value,doctype:"Contact",docname:o(a).doc.name,onReload:o(D).reload},null,8,["sections","docname","onReload"])])):m("",!0)]),_:1},8,["parent"])):m("",!0),u(o(Se),{as:"div",modelValue:L.value,"onUpdate:modelValue":n[2]||(n[2]=t=>L.value=t),tabs:te},{"tab-item":_(({tab:t,selected:c})=>[i("button",{class:G(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":c}])},[t.icon?(l(),d(V(t.icon),{key:0,class:"h-5"})):m("",!0),X(" "+b(e.__(t.label))+" ",1),u(w,{class:G(["group-hover:bg-surface-gray-7",[c?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:_(()=>[X(b(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":_(({tab:t})=>[t.label==="Deals"&&S.value.length?(l(),d(be,{key:0,class:"mt-4",rows:S.value,columns:se.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):m("",!0),S.value.length?m("",!0):(l(),v("div",Ze,[i("div",ea,[(l(),d(V(t.icon),{class:"!h-10 !w-10"})),i("div",null,b(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):T.value?(l(),d(me,{key:2,errorTitle:T.value,errorMessage:Z.value},null,8,["errorTitle","errorMessage"])):m("",!0),k.value?(l(),d(r,{key:3,modelValue:k.value,"onUpdate:modelValue":n[3]||(n[3]=t=>k.value=t),doctype:"Contact",docname:o(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{Pa as default};
//# sourceMappingURL=Contact-08216340.js.map
