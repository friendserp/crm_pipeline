import{aU as L,a5 as U,r as l,c as x,o as X,a,b as t,t as r,aE as d,F as y,f as b,g as n,n as f}from"./index-07f63b4e.js";const $={class:"min-h-screen bg-[#233d48] py-6 px-4"},M={class:"max-w-6xl mx-auto"},H={class:"flex justify-between items-center mb-8"},V={class:"text-2xl font-bold text-white"},G={class:"flex space-x-3"},z={key:0,class:"flex justify-center items-center py-12"},W={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},q={class:"lg:col-span-2 space-y-6"},K={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},Q={class:"p-4"},Y={class:"space-y-3"},Z={class:"text-gray-300"},tt={class:"text-gray-300"},et={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},st={class:"p-4"},ot={class:"space-y-4"},rt={class:"text-gray-300"},at={class:"text-white"},nt={class:"text-gray-300"},it={class:"text-white"},dt={class:"text-gray-300"},lt={class:"text-white"},ct={class:"text-gray-300"},ut={class:"text-white"},pt={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},mt={class:"p-4 border-b border-[#233d48] bg-[#233d48]"},ht={class:"flex justify-between items-center"},_t={class:"bg-[#8acc33] text-white px-2 py-1 rounded text-sm"},gt={class:"p-4"},xt={key:0,class:"text-center py-4"},yt={key:1,class:"space-y-4"},bt={class:"flex justify-between items-start mb-2"},ft={class:"text-white font-medium"},vt=["innerHTML"],wt={class:"grid grid-cols-2 gap-2 text-sm"},Ct={class:"text-gray-300"},kt={class:"text-gray-300"},Tt={class:"text-gray-300"},St={class:"text-gray-300"},jt={class:"mt-3 pt-3 border-t border-[#233d48]"},Ft={class:"flex justify-between items-center text-sm"},Et={class:"text-gray-300"},Nt={class:"text-gray-300"},Ot={class:"space-y-6"},At={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},Pt={class:"p-4 border-b border-[#233d48] bg-[#233d48]"},Dt={class:"flex justify-between items-center"},Rt={class:"bg-[#8acc33] text-white px-2 py-1 rounded text-sm"},Bt={class:"p-4"},It={key:0,class:"text-center py-4"},Jt={key:1,class:"space-y-4"},Lt={class:"flex justify-between items-start mb-2"},Ut={class:"text-white font-medium"},Xt={class:"text-gray-300 text-sm mb-3"},$t={class:"space-y-2 text-sm"},Mt={class:"flex justify-between"},Ht={class:"text-white"},Vt={class:"flex justify-between"},Gt={class:"text-white"},zt={class:"mt-3 pt-3 border-t border-[#233d48]"},Wt={class:"flex justify-between items-center text-sm"},qt={class:"text-gray-300"},Kt={class:"text-gray-300"},Qt={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},Yt={class:"p-4 border-b border-[#233d48] bg-[#233d48]"},Zt={class:"flex justify-between items-center"},te={class:"bg-[#8acc33] text-white px-2 py-1 rounded text-sm"},ee={class:"p-4"},se={key:0,class:"text-center py-4"},oe={key:1,class:"space-y-4"},re={class:"flex justify-between items-start mb-3"},ae={class:"text-white font-medium"},ne={class:"text-gray-300 text-sm"},ie={class:"grid grid-cols-2 gap-4 text-sm mb-3"},de={class:"text-white"},le={class:"text-white font-medium"},ce={class:"flex justify-between items-center text-sm pt-3 border-t border-[#233d48]"},ue={class:"text-gray-300"},pe=["onClick"],me={class:"bg-[#2a4a58] rounded-lg shadow-xl border border-[#2a4a58] overflow-hidden"},he={class:"p-4"},_e={class:"text-2xl font-bold text-white mb-2"},ye={__name:"Customer",setup(ge){const k=L(),T=U(),i=l({}),m=l(!1);l("");const v=l([]),w=l([]),u=l([]),S=l("ETB"),h=x(()=>v.value.filter(s=>{var e;return s.customer_name===i.value.customer_name||((e=s.subject)==null?void 0:e.includes(i.value.customer_name))})),_=x(()=>w.value.filter(s=>s.customer_name===i.value.customer_name)),j=x(()=>u.value.reduce((s,e)=>s+(parseFloat(e.outstanding_amount)||0),0)),F=async()=>{m.value=!0;try{const s=k.params.customerId,e=await fetch(`/api/resource/Customer/${s}`,{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()}});if(e.ok){const o=await e.json();i.value=o.data,await Promise.all([A(s),N(s),O(s),E(s)])}else console.error("Failed to fetch customer details")}catch(s){console.error("Error fetching customer:",s)}finally{m.value=!1}},E=async s=>{try{const e=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()},body:JSON.stringify({doctype:"Sales Invoice",filters:[["customer","=",s]],fields:["name","posting_date","due_date","grand_total","outstanding_amount","status","currency","company"],order_by:"posting_date desc",limit:20})});if(e.ok){const o=await e.json();u.value=o.message||[]}else console.error("Failed to fetch sales invoices")}catch(e){console.error("Error fetching sales invoices:",e)}},N=async s=>{try{const e=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()},body:JSON.stringify({doctype:"Task",filters:[["customer","=",s]],fields:["*"],limit:50})});if(e.ok){const o=await e.json();v.value=o.message||[]}else console.error("Failed to fetch tasks")}catch(e){console.error("Error fetching tasks:",e)}},O=async s=>{try{const e=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()},body:JSON.stringify({doctype:"Appointment",filters:[["customer_name","=",s]],fields:["*"],limit:50})});if(e.ok){const o=await e.json();w.value=o.message||[]}else console.error("Failed to fetch appointments")}catch(e){console.error("Error fetching appointments:",e)}},A=async s=>{try{const e=await fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()},body:JSON.stringify({doctype:"Address",filters:{"links.link_name":s},fields:["name","address_line1","address_line2","city","state","country","pincode","phone","email_id"],limit:1})});if(e.ok){const o=await e.json();if(o.message&&o.message.length>0){const J=o.message[0]}}}catch(e){console.error("Error fetching address:",e)}},c=async()=>{try{return(await(await fetch("/api/method/frappe.csrf_token.get_csrf_token")).json()).message.csrf_token}catch(s){return console.error("Error getting CSRF token:",s),""}},P=s=>({Open:"bg-blue-500 text-white",Working:"bg-yellow-500 text-white",Completed:"bg-green-500 text-white",Cancelled:"bg-red-500 text-white",Overdue:"bg-orange-500 text-white"})[s]||"bg-gray-500 text-white",D=s=>({Scheduled:"bg-blue-500 text-white",Confirmed:"bg-green-500 text-white",Cancelled:"bg-red-500 text-white",Unverified:"bg-yellow-500 text-white",Completed:"bg-purple-500 text-white"})[s]||"bg-gray-500 text-white",R=s=>({Draft:"bg-gray-500 text-white",Submitted:"bg-blue-500 text-white",Paid:"bg-green-500 text-white","Partly Paid":"bg-yellow-500 text-white",Unpaid:"bg-orange-500 text-white",Overdue:"bg-red-500 text-white",Cancelled:"bg-red-500 text-white"})[s]||"bg-gray-500 text-white",p=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",C=s=>s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",g=(s,e="ETB")=>s==null?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:e,minimumFractionDigits:2}).format(s),B=s=>{window.open(`/app/sales-invoice/${s}`,"_blank")},I=async()=>{if(confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{(await fetch("/api/method/frappe.client.delete",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":await c()},body:JSON.stringify({doctype:"Customer",name:i.value.name})})).ok?(alert("Customer deleted successfully!"),T.push("/customers")):(console.error("Failed to delete customer"),alert("Failed to delete customer. Please try again."))}catch(s){console.error("Error deleting customer:",s),alert("Error deleting customer. Please try again.")}};return X(()=>{F()}),(s,e)=>(n(),a("div",$,[t("div",M,[t("div",H,[t("div",null,[t("h1",V,r(i.value.customer_name),1),e[1]||(e[1]=t("p",{class:"text-gray-300"},"Customer Details",-1))]),t("div",G,[t("button",{onClick:e[0]||(e[0]=o=>s.$router.back()),class:"px-4 py-2 border border-[#8acc33] text-[#8acc33] bg-[#233d48] hover:bg-[#2a4a58] rounded-md font-medium transition-colors duration-200"}," Back to Customers "),t("button",{onClick:I,class:"px-4 py-2 bg-red-600 text-white rounded-md font-medium transition-colors duration-200 hover:bg-red-700"}," Delete Customer ")])]),m.value?(n(),a("div",z,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#8acc33]"},null,-1)])])):(n(),a("div",W,[t("div",q,[t("div",K,[e[4]||(e[4]=t("div",{class:"p-4 border-b border-[#233d48] bg-[#233d48]"},[t("h3",{class:"text-lg font-semibold text-white"},"Properties")],-1)),t("div",Q,[t("div",Y,[t("div",null,[e[3]||(e[3]=t("h4",{class:"text-[#8acc33] font-medium"},"Megengaya",-1)),t("p",Z,r(i.value.customer_primary_address||"Addis Ababa"),1),t("p",tt,r(i.value.territory||"Oromba"),1)])])])]),t("div",et,[e[9]||(e[9]=t("div",{class:"p-4 border-b border-[#233d48] bg-[#233d48]"},[t("h3",{class:"text-lg font-semibold text-white"},"Contacts")],-1)),t("div",st,[t("div",ot,[t("div",null,[t("p",rt,[e[5]||(e[5]=d("Name: ",-1)),t("span",at,r(i.value.customer_name),1)]),t("p",nt,[e[6]||(e[6]=d("Role: ",-1)),t("span",it,r(i.value.customer_type),1)]),t("p",dt,[e[7]||(e[7]=d("Phone: ",-1)),t("span",lt,r(i.value.mobile_no||"N/A"),1)]),t("p",ct,[e[8]||(e[8]=d("Email: ",-1)),t("span",ut,r(i.value.email_id||"N/A"),1)])])])])]),t("div",pt,[t("div",mt,[t("div",ht,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-white"},"Jobs",-1)),t("span",_t,r(h.value.length)+" jobs ",1)])]),t("div",gt,[h.value.length===0?(n(),a("div",xt,[...e[11]||(e[11]=[t("p",{class:"text-gray-300"},"No jobs found for this customer",-1)])])):(n(),a("div",yt,[(n(!0),a(y,null,b(h.value,o=>(n(),a("div",{key:o.name,class:"border border-[#233d48] rounded-lg p-4 hover:border-[#8acc33] transition-colors duration-200"},[t("div",bt,[t("h4",ft,r(o.subject),1),t("span",{class:f(["px-2 py-1 rounded text-xs",P(o.status)])},r(o.status),3)]),t("p",{class:"text-gray-300 text-sm mb-2",innerHTML:o.description},null,8,vt),t("div",wt,[t("div",Ct,[e[12]||(e[12]=t("span",{class:"text-[#8acc33]"},"Type:",-1)),d(" "+r(o.type),1)]),t("div",kt,[e[13]||(e[13]=t("span",{class:"text-[#8acc33]"},"Priority:",-1)),d(" "+r(o.priority),1)]),t("div",Tt,[e[14]||(e[14]=t("span",{class:"text-[#8acc33]"},"Start:",-1)),d(" "+r(p(o.exp_start_date)),1)]),t("div",St,[e[15]||(e[15]=t("span",{class:"text-[#8acc33]"},"End:",-1)),d(" "+r(p(o.exp_end_date)),1)])]),t("div",jt,[t("div",Ft,[t("span",Et,"Progress: "+r(o.progress)+"%",1),t("span",Nt,"Expected Time: "+r(o.expected_time)+"h",1)])])]))),128))]))])])]),t("div",Ot,[t("div",At,[t("div",Pt,[t("div",Dt,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-white"},"Schedule",-1)),t("span",Rt,r(_.value.length)+" appointments ",1)])]),t("div",Bt,[_.value.length===0?(n(),a("div",It,[...e[17]||(e[17]=[t("p",{class:"text-gray-300"},"No appointments scheduled",-1)])])):(n(),a("div",Jt,[(n(!0),a(y,null,b(_.value,o=>(n(),a("div",{key:o.name,class:"border border-[#233d48] rounded-lg p-4 hover:border-[#8acc33] transition-colors duration-200"},[t("div",Lt,[t("h4",Ut,"Appointment with "+r(o.appointment_with),1),t("span",{class:f(["px-2 py-1 rounded text-xs",D(o.status)])},r(o.status),3)]),t("p",Xt,r(o.customer_details),1),t("div",$t,[t("div",Mt,[e[18]||(e[18]=t("span",{class:"text-gray-300"},"Scheduled Time:",-1)),t("span",Ht,r(C(o.scheduled_time)),1)]),t("div",Vt,[e[19]||(e[19]=t("span",{class:"text-gray-300"},"End Time:",-1)),t("span",Gt,r(C(o.custom_scheduled_end_time)),1)])]),t("div",zt,[t("div",Wt,[t("span",qt,"Phone: "+r(o.customer_phone_number),1),t("span",Kt,"Email: "+r(o.customer_email),1)])])]))),128))]))])]),t("div",Qt,[t("div",Yt,[t("div",Zt,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold text-white"},"Billing History",-1)),t("span",te,r(u.value.length)+" invoices ",1)])]),t("div",ee,[u.value.length===0?(n(),a("div",se,[...e[21]||(e[21]=[t("p",{class:"text-gray-300"},"No billing history",-1),t("p",{class:"text-gray-300 text-sm"},"This client hasn't been billed yet",-1)])])):(n(),a("div",oe,[(n(!0),a(y,null,b(u.value,o=>(n(),a("div",{key:o.name,class:"border border-[#233d48] rounded-lg p-4 hover:border-[#8acc33] transition-colors duration-200"},[t("div",re,[t("div",null,[t("h4",ae,r(o.name),1),t("p",ne,r(p(o.posting_date)),1)]),t("span",{class:f(["px-2 py-1 rounded text-xs",R(o.status)])},r(o.status),3)]),t("div",ie,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-gray-300"},"Due Date",-1)),t("p",de,r(p(o.due_date)),1)]),t("div",null,[e[23]||(e[23]=t("p",{class:"text-gray-300"},"Grand Total",-1)),t("p",le,r(g(o.grand_total,o.currency)),1)])]),t("div",ce,[t("span",ue," Outstanding: "+r(g(o.outstanding_amount,o.currency)),1),t("button",{onClick:J=>B(o.name),class:"text-[#8acc33] hover:text-green-300 transition-colors duration-200"}," View Details ",8,pe)])]))),128))]))])]),t("div",me,[e[25]||(e[25]=t("div",{class:"p-4 border-b border-[#233d48] bg-[#233d48]"},[t("h3",{class:"text-lg font-semibold text-white"},"Current Balance")],-1)),t("div",he,[t("p",_e,r(g(j.value,S.value)),1),e[24]||(e[24]=t("p",{class:"text-gray-300 text-sm"},"Total Outstanding Amount",-1))])])])]))])]))}};export{ye as default};
//# sourceMappingURL=Customer-2dce468a.js.map
